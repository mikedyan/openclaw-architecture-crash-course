<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw Architecture — Interactive Masterclass</title>
<style>
:root {
  --bg: #0a0a0c;
  --bg2: #121215;
  --bg3: #1c1c21;
  --border: #2a2a30;
  --text: #dcdce0;
  --dim: #6b6b76;
  --cyan: #f97316;
  --ember: #fb923c;
  --gold: #eab308;
  --green: #34d399;
  --red: #f87171;
  --purple: #a78bfa;
  --glass: rgba(249,115,22,0.04);
  --glass-border: rgba(249,115,22,0.10);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); overflow: hidden; height: 100vh; }
.mono { font-family: 'JetBrains Mono','SF Mono','Fira Code','Consolas', monospace; }

/* === NAV === */
.nav { position:fixed; top:0; left:0; right:0; height:44px; background:var(--bg); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; padding:0 16px; z-index:100; }
.nav-title { font-size:10px; color:var(--dim); letter-spacing:2px; text-transform:uppercase; }
.nav-title strong { color:var(--cyan); letter-spacing:0.5px; text-transform:none; font-size:13px; }
.nav-dots { display:flex; gap:3px; }
.nav-dot { width:6px; height:6px; border-radius:1px; background:var(--bg3); border:1px solid var(--border); cursor:pointer; transition:all .2s; transform:rotate(45deg); }
.nav-dot.active { background:var(--cyan); border-color:var(--cyan); transform:rotate(45deg) scale(1.3); box-shadow:0 0 6px rgba(249,115,22,0.4); }
.nav-dot.visited { background:var(--green); border-color:var(--green); }
.nav-btns { display:flex; gap:6px; }
.nav-btn { padding:5px 14px; border-radius:3px; border:1px solid var(--border); background:transparent; color:var(--text); cursor:pointer; font-size:10px; font-weight:500; letter-spacing:0.8px; text-transform:uppercase; transition:all .15s; }
.nav-btn:hover { border-color:var(--cyan); color:var(--cyan); }
.nav-btn.primary { background:var(--cyan); color:#000; border-color:var(--cyan); font-weight:700; }
.nav-btn.primary:hover { background:#ea580c; border-color:#ea580c; }
.nav-btn:disabled { opacity:.25; cursor:not-allowed; }

/* === PROGRESS BAR === */
.progress-bar { position:fixed; top:44px; left:0; right:0; height:2px; background:var(--bg3); z-index:99; }
.progress-fill { height:100%; background:var(--cyan); transition:width .5s; width:0; }

/* === SCORE === */
.score { position:fixed; bottom:12px; right:12px; background:var(--bg2); border:1px solid var(--border); border-left:3px solid var(--gold); border-radius:2px; padding:6px 12px; font-size:10px; color:var(--dim); z-index:100; font-variant-numeric:tabular-nums; letter-spacing:0.5px; text-transform:uppercase; }
.score span { color:var(--gold); font-weight:600; }

/* === KEYS HINT === */
.keys-hint { position:fixed; bottom:12px; left:12px; font-size:10px; color:var(--dim); z-index:100; letter-spacing:0.5px; }
kbd { background:var(--bg3); border:1px solid var(--border); border-radius:2px; padding:1px 5px; font-size:10px; }

/* === SLIDES === */
.slide-wrap { margin-top:44px; height:calc(100vh - 44px); overflow-y:auto; }
.slide { display:none; min-height:calc(100vh - 46px); padding:36px 48px; max-width:960px; margin:0 auto; animation:fadeIn .3s ease; }
.slide.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

h1 { font-size:34px; color:var(--cyan); font-weight:700; margin-bottom:6px; letter-spacing:-0.5px; }
h2 { font-size:22px; color:var(--cyan); margin-bottom:12px; font-weight:600; letter-spacing:-0.3px; }
h3 { font-size:16px; margin:18px 0 8px; font-weight:600; }
p { font-size:14px; line-height:1.7; margin-bottom:10px; }
.sub { font-size:15px; color:var(--dim); margin-bottom:24px; }
strong, .accent { color:var(--cyan); }
.ember { color:var(--ember); }
.gold { color:var(--gold); }
.dim { color:var(--dim); }

/* === CARDS === */
.glass { background:var(--bg2); border:1px solid var(--border); border-left:3px solid var(--cyan); border-radius:2px; padding:18px; margin:14px 0; }

/* === TERMINAL === */
.term { background:#000; border-radius:3px; overflow:hidden; border:1px solid var(--border); margin:14px 0; }
.term-bar { background:var(--bg2); padding:5px 12px; display:flex; gap:6px; align-items:center; border-bottom:1px solid var(--border); }
.term-dot { width:8px; height:8px; border-radius:50%; opacity:0.5; }
.term-dot.r { background:#ef4444; } .term-dot.y { background:#eab308; } .term-dot.g { background:#22c55e; }
.term-body { padding:14px 16px; font-family:'JetBrains Mono','SF Mono','Fira Code',monospace; font-size:12px; min-height:60px; max-height:400px; overflow-y:auto; line-height:1.7; }
.term-prompt { color:var(--cyan); }
.term-cmd { color:#fff; }
.term-out { color:var(--dim); }
.term-ok { color:var(--green); }
.term-err { color:var(--red); }
.term-hl { color:var(--gold); }
.term-input { background:transparent; border:none; color:#fff; font-family:inherit; font-size:inherit; outline:none; caret-color:var(--cyan); width:calc(100% - 30px); }
.cursor-blink { animation: blink 1s step-end infinite; color:var(--cyan); }
@keyframes blink { 50% { opacity:0; } }

/* === DEPTH SLIDER === */
.depth-wrap { margin:18px 0; }
.depth-slider { width:100%; -webkit-appearance:none; height:4px; border-radius:2px; background:var(--bg3); outline:none; }
.depth-slider::-webkit-slider-thumb { -webkit-appearance:none; width:16px; height:16px; border-radius:2px; background:var(--cyan); cursor:pointer; box-shadow:0 0 8px rgba(249,115,22,0.3); transform:rotate(45deg); }
.depth-label { font-size:10px; color:var(--dim); text-align:center; margin-top:6px; text-transform:uppercase; letter-spacing:1px; }
.depth-view { min-height:280px; position:relative; border-radius:3px; border:1px solid var(--border); background:var(--bg2); padding:20px; margin:14px 0; overflow:hidden; }
.depth-layer { transition: all .4s cubic-bezier(.16,1,.3,1); position:relative; margin:6px 0; padding:12px 16px; border-radius:3px; border:1px solid transparent; }
.depth-layer.visible { opacity:1; transform:translateY(0); }
.depth-layer.hidden { opacity:0; transform:translateY(16px); pointer-events:none; position:absolute; }

/* === MESSAGE TRACE === */
.trace-canvas { position:relative; height:200px; margin:18px 0; background:var(--bg2); border-radius:3px; border:1px solid var(--border); overflow:hidden; }
.trace-node { position:absolute; padding:8px 14px; border-radius:3px; font-size:11px; font-weight:600; text-align:center; border:1px solid var(--border); background:var(--bg); transition:border-color .3s, box-shadow .3s; z-index:2; }
.trace-node.lit { border-color:var(--cyan); box-shadow:0 0 12px rgba(249,115,22,.2); }
.trace-particle { position:absolute; width:10px; height:10px; border-radius:50%; background:var(--cyan); box-shadow:0 0 10px var(--cyan); z-index:3; transition:all .6s ease; display:none; }
.trace-line { position:absolute; height:1px; background:var(--border); z-index:1; transition:background .3s; }
.trace-line.lit { background:var(--cyan); }
.trace-inspector { display:none; margin:10px 0; }
.trace-inspector.show { display:block; }

/* === FRAME INSPECTOR === */
.inspector-wrap { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:14px 0; min-height:340px; }
.frame-log { background:#000; border-radius:3px; border:1px solid var(--border); padding:10px; overflow-y:auto; max-height:340px; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; }
.frame-entry { padding:5px 8px; border-radius:2px; cursor:pointer; margin:2px 0; transition:background .15s; display:flex; gap:8px; align-items:center; }
.frame-entry:hover { background:rgba(255,255,255,.04); }
.frame-entry.selected { background:rgba(249,115,22,.06); border-left:2px solid var(--cyan); }
.frame-badge { padding:2px 6px; border-radius:2px; font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px; }
.frame-badge.auth { background:rgba(251,146,60,.12); color:var(--ember); }
.frame-badge.chat { background:rgba(249,115,22,.12); color:var(--cyan); }
.frame-badge.tool { background:rgba(167,139,250,.12); color:var(--purple); }
.frame-badge.sys { background:rgba(107,107,118,.12); color:var(--dim); }
.frame-badge.err { background:rgba(248,113,113,.12); color:var(--red); }
.frame-detail { background:var(--bg2); border-radius:3px; border:1px solid var(--border); padding:14px; overflow-y:auto; max-height:340px; }
.filter-btns { display:flex; gap:4px; margin-bottom:10px; flex-wrap:wrap; }
.filter-btn { padding:4px 10px; border-radius:2px; border:1px solid var(--border); background:transparent; color:var(--dim); cursor:pointer; font-size:10px; font-weight:500; text-transform:uppercase; letter-spacing:0.5px; transition:all .15s; }
.filter-btn.active { border-color:var(--cyan); color:var(--cyan); background:rgba(249,115,22,.06); }
.filter-btn.corrupt { border-color:var(--red); color:var(--red); }

/* === DRAG AND DROP === */
.drag-area { display:flex; gap:12px; margin:14px 0; min-height:300px; }
.drag-col { flex:1; background:var(--bg2); border-radius:3px; border:1px solid var(--border); padding:12px; }
.drag-col h4 { font-size:10px; color:var(--dim); text-transform:uppercase; letter-spacing:1.5px; margin-bottom:10px; }
.drag-item { padding:8px 12px; border-radius:3px; border:1px solid var(--border); background:var(--bg); margin:5px 0; cursor:grab; font-size:12px; transition:all .15s; user-select:none; }
.drag-item:active { cursor:grabbing; }
.drag-item.dragging { opacity:.3; }
.drag-item.correct { border-color:var(--green); background:rgba(52,211,153,.06); border-left:3px solid var(--green); }
.drag-item.wrong { border-color:var(--red); background:rgba(248,113,113,.06); animation:shake .3s; }
@keyframes shake { 25%{transform:translateX(-3px)} 75%{transform:translateX(3px)} }
.drop-zone { min-height:48px; border:1px dashed var(--border); border-radius:3px; padding:8px; transition:all .15s; }
.drop-zone.over { border-color:var(--cyan); background:rgba(249,115,22,.04); border-style:solid; }
.drag-item .channel-icon { display:inline-block; width:7px; height:7px; border-radius:1px; margin-right:6px; transform:rotate(45deg); }

/* === AUTH DOORS === */
.auth-doors { display:grid; grid-template-columns:repeat(5,1fr); gap:8px; margin:14px 0; }
.auth-door { background:var(--bg2); border:1px solid var(--border); border-radius:3px; padding:14px 10px; text-align:center; transition:all .2s; min-height:200px; display:flex; flex-direction:column; justify-content:space-between; }
.auth-door.solved { border-color:var(--green); border-left:3px solid var(--green); background:rgba(52,211,153,.03); }
.auth-door h4 { font-size:11px; margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px; }
.auth-door .lock { font-size:24px; margin:6px 0; }
.auth-door.solved .lock { color:var(--green); }
.auth-input { background:var(--bg); border:1px solid var(--border); border-radius:2px; padding:5px 8px; color:var(--text); font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; width:100%; margin:3px 0; outline:none; }
.auth-input:focus { border-color:var(--cyan); }
.auth-opt { display:block; padding:5px 8px; margin:3px 0; border-radius:2px; border:1px solid var(--border); background:var(--bg); cursor:pointer; font-size:11px; transition:all .15s; text-align:left; }
.auth-opt:hover { border-color:var(--cyan); }
.auth-opt.correct { border-color:var(--green); background:rgba(52,211,153,.08); }
.auth-opt.wrong { border-color:var(--red); background:rgba(248,113,113,.08); }

/* === DEBUGGER === */
.debugger { background:var(--bg2); border:1px solid var(--border); border-radius:3px; overflow:hidden; margin:14px 0; }
.debug-toolbar { background:var(--bg3); padding:8px 14px; display:flex; gap:6px; align-items:center; border-bottom:1px solid var(--border); }
.debug-btn { padding:4px 10px; border-radius:2px; border:1px solid var(--border); background:transparent; color:var(--text); cursor:pointer; font-size:10px; font-weight:500; transition:all .15s; text-transform:uppercase; letter-spacing:0.3px; }
.debug-btn:hover:not(:disabled) { border-color:var(--cyan); color:var(--cyan); }
.debug-btn:disabled { opacity:.25; cursor:not-allowed; }
.debug-btn.active { background:var(--cyan); color:#000; border-color:var(--cyan); }
.debug-steps { padding:14px; }
.debug-step { padding:8px 12px; border-radius:2px; margin:3px 0; border-left:3px solid var(--border); font-size:12px; cursor:pointer; transition:all .15s; }
.debug-step.current { border-left-color:var(--cyan); background:rgba(249,115,22,.04); }
.debug-step.done { border-left-color:var(--green); color:var(--dim); }
.debug-step.bp { position:relative; }
.debug-step.bp::before { content:''; position:absolute; left:-9px; top:50%; transform:translateY(-50%); width:8px; height:8px; border-radius:50%; background:var(--red); }
.debug-data { padding:14px; border-top:1px solid var(--border); background:var(--bg); font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; max-height:200px; overflow-y:auto; white-space:pre-wrap; color:var(--text); }

/* === FILE TREE === */
.ftree { font-family:'JetBrains Mono','SF Mono',monospace; font-size:12px; background:var(--bg); border:1px solid var(--border); border-radius:3px; padding:10px 14px; line-height:1.8; }
.ftree-item { cursor:pointer; padding:2px 4px; border-radius:2px; transition:background .15s; }
.ftree-item:hover { background:rgba(249,115,22,.05); }
.ftree-folder { color:var(--cyan); }
.ftree-file { color:var(--text); }
.ftree-viewer { background:var(--bg2); border:1px solid var(--border); border-radius:3px; padding:14px; margin-top:10px; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; max-height:300px; overflow-y:auto; white-space:pre-wrap; line-height:1.6; display:none; }
.ftree-viewer.show { display:block; }

/* === CHAOS CONSOLE === */
.chaos-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:14px 0; }
.chaos-toggles { display:flex; flex-direction:column; gap:6px; }
.chaos-toggle { display:flex; align-items:center; justify-content:space-between; padding:8px 12px; background:var(--bg2); border:1px solid var(--border); border-radius:3px; font-size:12px; }
.chaos-switch { position:relative; width:36px; height:20px; border-radius:3px; background:var(--bg3); border:1px solid var(--border); cursor:pointer; transition:all .2s; }
.chaos-switch.on { background:var(--red); border-color:var(--red); }
.chaos-switch::after { content:''; position:absolute; top:2px; left:2px; width:14px; height:14px; border-radius:2px; background:#fff; transition:all .2s; }
.chaos-switch.on::after { left:18px; }
.chaos-log { background:#000; border-radius:3px; border:1px solid var(--border); padding:10px; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; max-height:280px; overflow-y:auto; }
.chaos-entry { margin:2px 0; }

/* === QUIZ === */
.quiz { background:var(--bg2); border:1px solid var(--border); border-left:3px solid var(--purple); border-radius:3px; padding:18px; margin:14px 0; }
.quiz-q { font-size:14px; font-weight:600; margin-bottom:12px; }
.quiz-opt { display:block; width:100%; padding:9px 12px; margin:5px 0; border-radius:3px; border:1px solid var(--border); background:var(--bg); color:var(--text); cursor:pointer; font-size:12px; text-align:left; transition:all .15s; }
.quiz-opt:hover:not(:disabled) { border-color:var(--cyan); }
.quiz-opt.correct { border-color:var(--green); background:rgba(52,211,153,.08); color:var(--green); }
.quiz-opt.wrong { border-color:var(--red); background:rgba(248,113,113,.08); color:var(--red); }
.quiz-opt:disabled { cursor:default; }
.quiz-fb { margin-top:8px; padding:8px 12px; border-radius:3px; font-size:12px; display:none; }
.quiz-fb.show { display:block; }
.quiz-fb.ok { background:rgba(52,211,153,.08); color:var(--green); border-left:3px solid var(--green); }
.quiz-fb.no { background:rgba(248,113,113,.08); color:var(--red); border-left:3px solid var(--red); }

/* === SANDBOX === */
.sandbox { display:grid; grid-template-columns:1fr 1fr; grid-template-rows:1fr 1fr; gap:6px; margin:14px 0; height:420px; }
.sandbox-panel { background:var(--bg2); border:1px solid var(--border); border-radius:3px; overflow:hidden; display:flex; flex-direction:column; }
.sandbox-header { padding:5px 10px; background:var(--bg3); border-bottom:1px solid var(--border); font-size:9px; font-weight:600; color:var(--dim); text-transform:uppercase; letter-spacing:1.5px; }
.sandbox-body { flex:1; padding:8px; overflow-y:auto; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; line-height:1.6; }
.sandbox-input { display:flex; border-top:1px solid var(--border); }
.sandbox-input input { flex:1; background:transparent; border:none; padding:7px 10px; color:var(--text); font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; outline:none; }
.sandbox-input button { padding:7px 12px; background:var(--cyan); color:#000; border:none; font-weight:700; cursor:pointer; font-size:10px; text-transform:uppercase; letter-spacing:0.5px; }

/* === PLAYER === */
.player { margin:14px 0; }
.player-display { background:#000; border:1px solid var(--border); border-radius:3px 3px 0 0; padding:14px; min-height:240px; max-height:300px; overflow-y:auto; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; }
.player-entry { padding:5px 0; border-bottom:1px solid rgba(255,255,255,.03); animation:fadeIn .3s; }
.player-role { font-weight:600; margin-right:8px; }
.player-role.user { color:#60a5fa; }
.player-role.assistant { color:var(--cyan); }
.player-role.tool-call { color:var(--ember); }
.player-role.tool-result { color:var(--green); }
.player-role.system { color:var(--dim); }
.player-controls { display:flex; align-items:center; gap:10px; background:var(--bg3); border:1px solid var(--border); border-top:none; border-radius:0 0 3px 3px; padding:8px 14px; }
.player-btn { background:transparent; border:1px solid var(--border); border-radius:2px; padding:4px 10px; color:var(--text); cursor:pointer; font-size:11px; }
.player-btn:hover { border-color:var(--cyan); }
.player-timeline { flex:1; -webkit-appearance:none; height:3px; border-radius:2px; background:var(--bg); outline:none; }
.player-timeline::-webkit-slider-thumb { -webkit-appearance:none; width:12px; height:12px; border-radius:2px; background:var(--cyan); cursor:pointer; transform:rotate(45deg); }
.player-tokens { font-size:10px; color:var(--dim); font-family:'JetBrains Mono','SF Mono',monospace; font-variant-numeric:tabular-nums; }

/* === INSIGHT BOX === */
.insight { background:rgba(249,115,22,.03); border:1px solid rgba(249,115,22,.12); border-left:3px solid var(--cyan); border-radius:3px; padding:14px; margin:14px 0; }
.insight-label { font-size:9px; text-transform:uppercase; letter-spacing:2px; color:var(--cyan); margin-bottom:5px; font-weight:700; }

/* === API EXPLORER === */
.api-search { width:100%; padding:9px 14px; background:var(--bg); border:1px solid var(--border); border-radius:3px; color:var(--text); font-size:13px; outline:none; margin-bottom:10px; }
.api-search:focus { border-color:var(--cyan); }
.api-cats { display:flex; gap:4px; margin-bottom:10px; flex-wrap:wrap; }
.api-cat { padding:4px 10px; border-radius:2px; border:1px solid var(--border); background:transparent; color:var(--dim); cursor:pointer; font-size:10px; font-weight:500; text-transform:uppercase; letter-spacing:0.5px; transition:all .15s; }
.api-cat.active { border-color:var(--cyan); color:var(--cyan); background:rgba(249,115,22,.06); }
.api-list { max-height:400px; overflow-y:auto; }
.api-card { background:var(--bg2); border:1px solid var(--border); border-radius:3px; margin:4px 0; overflow:hidden; transition:all .15s; }
.api-card-head { padding:8px 12px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; font-size:12px; }
.api-card-head:hover { background:rgba(249,115,22,.03); }
.api-card-body { display:none; padding:10px 12px; border-top:1px solid var(--border); font-size:11px; }
.api-card.open .api-card-body { display:block; }

/* === NORMALIZER === */
.norm-tabs { display:flex; gap:2px; margin-bottom:10px; }
.norm-tab { padding:6px 14px; border-radius:3px 3px 0 0; border:1px solid var(--border); border-bottom:none; background:transparent; color:var(--dim); cursor:pointer; font-size:10px; font-weight:500; text-transform:uppercase; letter-spacing:0.5px; }
.norm-tab.active { background:var(--bg2); color:var(--cyan); border-color:var(--cyan); border-bottom:1px solid var(--bg2); }
.norm-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.norm-raw { background:#000; border-radius:3px; border:1px solid var(--border); padding:10px; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; max-height:320px; overflow-y:auto; }
.norm-field { padding:4px 8px; margin:2px; border-radius:2px; border:1px solid var(--border); background:var(--bg); cursor:grab; font-size:10px; display:inline-block; transition:all .15s; }
.norm-field:active { cursor:grabbing; }
.norm-field.placed { opacity:.35; cursor:default; }
.norm-slots { background:var(--bg2); border-radius:3px; border:1px solid var(--border); padding:10px; }
.norm-slot { min-height:28px; border:1px dashed var(--border); border-radius:2px; padding:4px 8px; margin:4px 0; font-size:11px; transition:all .15s; display:flex; align-items:center; gap:8px; }
.norm-slot.over { border-color:var(--cyan); background:rgba(249,115,22,.04); border-style:solid; }
.norm-slot.filled { border-style:solid; border-color:var(--green); }
.norm-slot-label { color:var(--dim); min-width:70px; font-size:10px; }

/* === TOOL WORKBENCH === */
.wb-tabs { display:flex; gap:2px; }
.wb-tab { padding:6px 14px; border-radius:3px 3px 0 0; border:1px solid var(--border); border-bottom:none; background:transparent; color:var(--dim); cursor:pointer; font-size:10px; font-weight:500; text-transform:uppercase; letter-spacing:0.5px; }
.wb-tab.active { background:var(--bg2); color:var(--cyan); border-color:var(--cyan); }
.wb-panel { display:none; background:var(--bg2); border:1px solid var(--border); border-radius:0 3px 3px 3px; min-height:250px; }
.wb-panel.active { display:flex; flex-direction:column; }
.wb-body { flex:1; padding:10px; overflow-y:auto; font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; max-height:200px; }
.wb-input { display:flex; border-top:1px solid var(--border); }
.wb-input input { flex:1; background:transparent; border:none; padding:7px 10px; color:var(--text); font-family:'JetBrains Mono','SF Mono',monospace; font-size:11px; outline:none; }
.wb-counter { display:flex; gap:14px; margin-top:6px; font-size:11px; color:var(--dim); font-variant-numeric:tabular-nums; }
.wb-counter span { color:var(--gold); }

/* === MULTI-AGENT === */
.ma-canvas { position:relative; height:280px; background:var(--bg2); border:1px solid var(--border); border-radius:3px; overflow:hidden; margin:10px 0; }
.ma-node { position:absolute; padding:7px 10px; border-radius:3px; border:1px solid var(--border); background:var(--bg); font-size:11px; text-align:center; cursor:pointer; transition:all .2s; z-index:2; min-width:88px; }
.ma-node:hover { border-color:var(--cyan); }
.ma-node.active { border-color:var(--cyan); box-shadow:0 0 12px rgba(249,115,22,.15); }
.ma-node .ma-model { font-size:9px; color:var(--dim); margin-top:2px; }
.ma-scenarios { display:flex; gap:6px; margin-bottom:10px; }

/* === NETWORK TOPO === */
.topo-canvas { position:relative; height:260px; background:var(--bg2); border:1px solid var(--border); border-radius:3px; overflow:hidden; margin:14px 0; }
.topo-node { position:absolute; padding:5px 9px; border-radius:3px; border:1px solid var(--border); background:var(--bg); font-size:10px; text-align:center; transition:all .2s; z-index:2; }
.topo-node.lit { border-color:var(--cyan); box-shadow:0 0 10px rgba(249,115,22,.2); }

/* === WATERFALL === */
.wf-row { display:flex; align-items:center; margin:3px 0; cursor:pointer; }
.wf-label { width:130px; font-size:10px; color:var(--dim); text-align:right; padding-right:8px; flex-shrink:0; text-transform:uppercase; letter-spacing:0.3px; }
.wf-track { flex:1; height:20px; background:var(--bg2); border-radius:2px; position:relative; overflow:hidden; }
.wf-bar { height:100%; border-radius:2px; position:absolute; transition:all .4s; display:flex; align-items:center; padding-left:6px; font-size:9px; color:#000; font-weight:600; }
.wf-detail { display:none; margin:3px 0 3px 138px; padding:8px; background:var(--bg2); border:1px solid var(--border); border-left:3px solid var(--cyan); border-radius:2px; font-size:11px; }
.wf-detail.show { display:block; }

/* === PROVIDER COMPARE === */
.prov-compare { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin:14px 0; }
.prov-panel { background:var(--bg2); border:1px solid var(--border); border-radius:3px; overflow:hidden; }
.prov-header { padding:7px 12px; background:var(--bg3); border-bottom:1px solid var(--border); font-size:11px; font-weight:600; }
.prov-body { padding:10px; font-size:12px; min-height:100px; }
.prov-stats { display:grid; grid-template-columns:1fr 1fr 1fr; gap:6px; padding:7px 12px; border-top:1px solid var(--border); font-size:10px; text-align:center; }
.prov-stat-val { font-size:14px; font-weight:600; font-variant-numeric:tabular-nums; }

/* === DOCKER LAYERS === */
.docker-area { display:flex; gap:12px; margin:14px 0; min-height:280px; }
.docker-source, .docker-target { flex:1; }
.docker-target { background:var(--bg2); border:1px solid var(--border); border-radius:3px; padding:10px; }
.docker-layer { padding:7px 10px; border-radius:3px; border:1px solid var(--border); background:var(--bg); margin:4px 0; cursor:grab; font-size:11px; font-family:'JetBrains Mono','SF Mono',monospace; transition:all .15s; }
.docker-layer:active { cursor:grabbing; }
.docker-layer.placed { opacity:.35; }
.docker-layer.correct { border-color:var(--green); border-left:3px solid var(--green); }
.docker-layer.wrong { border-color:var(--red); animation:shake .3s; }
.docker-slot { min-height:34px; border:1px dashed var(--border); border-radius:3px; margin:4px 0; transition:all .15s; display:flex; align-items:center; padding:0 10px; font-size:10px; color:var(--dim); }
.docker-slot.over { border-color:var(--cyan); border-style:solid; }
.docker-slot.filled { border-style:solid; }
.docker-error { margin-top:8px; padding:7px; background:rgba(248,113,113,.06); border:1px solid rgba(248,113,113,.15); border-left:3px solid var(--red); border-radius:2px; font-family:'JetBrains Mono','SF Mono',monospace; font-size:10px; color:var(--red); display:none; }

/* === SCROLLBAR === */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--bg3); border-radius:2px; }

/* === RESPONSIVE === */
@media(max-width:768px) {
  .slide { padding:20px; }
  h1 { font-size:28px; }
  .auth-doors { grid-template-columns:1fr 1fr; }
  .inspector-wrap { grid-template-columns:1fr; }
  .drag-area { flex-direction:column; }
  .sandbox { grid-template-columns:1fr; height:auto; }
  .norm-grid { grid-template-columns:1fr; }
  .prov-compare { grid-template-columns:1fr; }
  .docker-area { flex-direction:column; }
  .topo-canvas { height:400px; }
}
</style>
</head>
<body>

<div class="nav">
  <div class="nav-title"><strong>OpenClaw</strong>&nbsp; Architecture Masterclass</div>
  <div class="nav-dots" id="navDots"></div>
  <div class="nav-btns">
    <button class="nav-btn" id="prevBtn" onclick="go(-1)">Back</button>
    <button class="nav-btn primary" id="nextBtn" onclick="go(1)">Next</button>
  </div>
</div>
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<div class="score">Explored: <span id="scoreVal">0</span> / <span id="scoreMax">0</span></div>
<div class="keys-hint"><kbd>&larr;</kbd> <kbd>&rarr;</kbd> to navigate</div>

<div class="slide-wrap" id="slideWrap">

<!-- ======== SLIDE 0: BOOT ======== -->
<div class="slide" id="s0">
<div style="display:flex;flex-direction:column;justify-content:center;min-height:calc(100vh - 140px)">
<h1>OpenClaw Architecture</h1>
<p class="sub">Interactive deep-dive – from zero to mastery</p>
<div class="term" id="bootTerm">
  <div class="term-bar"><div class="term-dot r"></div><div class="term-dot y"></div><div class="term-dot g"></div><span style="margin-left:10px;font-size:11px;color:var(--dim)">Terminal</span></div>
  <div class="term-body" id="bootBody">
    <div><span class="term-prompt">~ $ </span><input class="term-input" id="bootInput" placeholder="type 'openclaw gateway' and press Enter" autofocus></div>
  </div>
</div>
<p class="dim" style="font-size:13px;margin-top:8px">Type the command above to boot OpenClaw and begin the masterclass.</p>
</div>
</div>

<!-- ======== SLIDE 1: WHAT IS OPENCLAW ======== -->
<div class="slide" id="s1">
<h2>What Is OpenClaw?</h2>
<p>Drag the slider to peel through the architecture layers – from the outside in.</p>
<div class="depth-wrap">
  <input type="range" class="depth-slider" id="depthSlider" min="0" max="100" value="0" oninput="updateDepth(this.value)">
  <div class="depth-label" id="depthLabel">External Layer –0%</div>
</div>
<div class="depth-view" id="depthView">
  <div class="depth-layer visible" id="dl0" style="border:1px solid var(--green);background:rgba(52,211,153,.05)">
    <strong style="color:var(--green)">External Layer</strong> – Messaging Apps<br>
    <span class="dim" style="font-size:13px">WhatsApp &bull; Telegram &bull; Discord &bull; iMessage &bull; Slack &bull; LINE &bull; Signal &bull; Teams &bull; Matrix</span>
  </div>
  <div class="depth-layer hidden" id="dl1" style="border:1px solid var(--ember);background:rgba(251,146,60,.05)">
    <strong style="color:var(--ember)">Channel Layer</strong> – Normalization Plugins<br>
    <span class="dim" style="font-size:13px">Each platform has a channel plugin that receives raw webhooks and normalizes them into a standard Message format. grammy (Telegram), Baileys (WhatsApp), discord.js, Bolt (Slack), etc.</span>
  </div>
  <div class="depth-layer hidden" id="dl2" style="border:1px solid var(--cyan);background:rgba(249,115,22,.04)">
    <strong class="accent">Gateway Layer</strong> – The Central Hub<br>
    <span class="dim" style="font-size:13px">WebSocket server (port 18789) + HTTP. 80+ API methods. Auth (token/password/Tailscale/device). Routing engine. Session management. Broadcast events. Hono.js + ws library.</span>
  </div>
  <div class="depth-layer hidden" id="dl3" style="border:1px solid var(--purple);background:rgba(167,139,250,.05)">
    <strong style="color:var(--purple)">Agent Runtime</strong> – Pi Engine<br>
    <span class="dim" style="font-size:13px">Calls LLMs (Claude/GPT/Gemini). Executes tools: bash, browser, files, web. Manages skills (SKILL.md files). Spawns sub-agents. Streams responses token-by-token via chat.delta events.</span>
  </div>
  <div class="depth-layer hidden" id="dl4" style="border:1px solid var(--gold);background:rgba(234,179,8,.04)">
    <strong style="color:var(--gold)">State Layer</strong> – File-Based Persistence<br>
    <span class="dim" style="font-size:13px">~/.openclaw/openclaw.json (config, JSON5). Session transcripts as JSONL files. Skills on disk. Cron jobs. Device auth keys. No database – everything is files.</span>
  </div>
</div>
<div class="insight"><div class="insight-label">Key Insight</div>OpenClaw is a <strong>self-hosted gateway</strong>. You run ONE process on your machine. It becomes the bridge between all your messaging apps and an AI agent that can actually <em>do things</em> – read files, write code, browse the web, execute shell commands. Your data stays on your hardware.</div>
</div>

<!-- ======== SLIDE 2: MESSAGE TRACE ======== -->
<div class="slide" id="s2">
<h2>The Message Journey</h2>
<p>Click the button to send a message and watch it traverse the entire pipeline. Click any node to inspect the data at that stage.</p>
<div class="trace-canvas" id="traceCanvas">
  <div class="trace-node" id="tn0" style="left:2%;top:38%;color:var(--green)" onclick="inspectTrace(0)">WhatsApp</div>
  <div class="trace-node" id="tn1" style="left:22%;top:38%;color:var(--ember)" onclick="inspectTrace(1)">Channel Plugin</div>
  <div class="trace-node" id="tn2" style="left:42%;top:38%;color:var(--cyan)" onclick="inspectTrace(2)">Gateway</div>
  <div class="trace-node" id="tn3" style="left:62%;top:38%;color:var(--purple)" onclick="inspectTrace(3)">Pi Agent</div>
  <div class="trace-node" id="tn4" style="left:82%;top:20%" onclick="inspectTrace(4)">LLM (Claude)</div>
  <div class="trace-node" id="tn5" style="left:82%;top:58%;color:var(--ember)" onclick="inspectTrace(5)">Tool (bash)</div>
  <div class="trace-particle" id="traceP"></div>
</div>
<button class="nav-btn primary" id="traceBtn" onclick="runTrace()" style="margin:8px 0">Send "Create hello.py"</button>
<div class="trace-inspector glass" id="traceInsp">
  <div style="font-size:12px;color:var(--dim);margin-bottom:6px" id="traceInspTitle"></div>
  <pre class="mono" style="font-size:12px;white-space:pre-wrap;color:var(--text)" id="traceInspBody"></pre>
</div>
</div>

<!-- ======== SLIDE 3: WEBSOCKET INSPECTOR ======== -->
<div class="slide" id="s3">
<h2>WebSocket Protocol</h2>
<p>OpenClaw communicates via <strong>WebSocket on port 18789</strong>. All messages are JSON frames. Click any frame to decode it.</p>
<div class="filter-btns">
  <button class="filter-btn active" onclick="filterFrames('all',this)">All</button>
  <button class="filter-btn" onclick="filterFrames('auth',this)">Auth</button>
  <button class="filter-btn" onclick="filterFrames('chat',this)">Chat</button>
  <button class="filter-btn" onclick="filterFrames('tool',this)">Tools</button>
  <button class="filter-btn" onclick="filterFrames('sys',this)">System</button>
  <button class="filter-btn corrupt" onclick="injectCorrupt()">Inject Corrupt Frame</button>
</div>
<div class="inspector-wrap">
  <div class="frame-log" id="frameLog"></div>
  <div class="frame-detail" id="frameDetail"><span class="dim">Click a frame to inspect it</span></div>
</div>
</div>

<!-- ======== SLIDE 4: API EXPLORER ======== -->
<div class="slide" id="s4">
<h2>80+ API Methods</h2>
<p>The Gateway exposes a massive API surface. Search and explore all methods below.</p>
<input class="api-search" id="apiSearch" placeholder="Search methods... (try 'chat', 'session', 'agent')" oninput="filterAPI()">
<div class="api-cats" id="apiCats">
  <span class="api-cat active" onclick="filterAPICat('all',this)">All (80+)</span>
  <span class="api-cat" onclick="filterAPICat('chat',this)">Chat</span>
  <span class="api-cat" onclick="filterAPICat('session',this)">Session</span>
  <span class="api-cat" onclick="filterAPICat('agent',this)">Agent</span>
  <span class="api-cat" onclick="filterAPICat('config',this)">Config</span>
  <span class="api-cat" onclick="filterAPICat('channel',this)">Channel</span>
  <span class="api-cat" onclick="filterAPICat('skill',this)">Skills</span>
  <span class="api-cat" onclick="filterAPICat('cron',this)">Cron</span>
  <span class="api-cat" onclick="filterAPICat('system',this)">System</span>
</div>
<div class="api-list" id="apiList"></div>
<div class="insight"><div class="insight-label">Design Pattern</div>Every method follows the same frame structure: <span class="mono">{type:"request", id, method, params}</span> → <span class="mono">{type:"response", id, result}</span>. No REST verbs, no URL paths — just WebSocket method calls. This makes the entire API explorable with a single connection.</div>
</div>

<!-- ======== SLIDE 5: MESSAGE NORMALIZER ======== -->
<div class="slide" id="s5">
<h2>Channel Normalizer</h2>
<p>Each platform sends different webhook formats. Drag fields from the raw payload to the correct slot in the normalized <strong>Message</strong> format. <span class="gold" id="normScore">0/5 mapped</span></p>
<div class="norm-tabs">
  <span class="norm-tab active" onclick="switchNormTab(0,this)">Telegram</span>
  <span class="norm-tab" onclick="switchNormTab(1,this)">WhatsApp</span>
  <span class="norm-tab" onclick="switchNormTab(2,this)">Discord</span>
</div>
<div class="norm-grid">
  <div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:6px">Raw Webhook — drag fields from here:</div>
    <div class="norm-raw" id="normRaw"></div>
    <div id="normFields" style="margin-top:8px"></div>
  </div>
  <div>
    <div style="font-size:11px;color:var(--dim);margin-bottom:6px">Normalized OpenClaw Message:</div>
    <div class="norm-slots">
      <div class="norm-slot" data-slot="sender" ondrop="dropNorm(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)"><span class="norm-slot-label">sender:</span></div>
      <div class="norm-slot" data-slot="channel" ondrop="dropNorm(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)"><span class="norm-slot-label">channel:</span></div>
      <div class="norm-slot" data-slot="text" ondrop="dropNorm(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)"><span class="norm-slot-label">text:</span></div>
      <div class="norm-slot" data-slot="chatId" ondrop="dropNorm(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)"><span class="norm-slot-label">chatId:</span></div>
      <div class="norm-slot" data-slot="timestamp" ondrop="dropNorm(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)"><span class="norm-slot-label">timestamp:</span></div>
    </div>
  </div>
</div>
</div>

<!-- ======== SLIDE 6: ROUTING ======== -->
<div class="slide" id="s6">
<h2>Message Routing</h2>
<p>Drag each message to the correct agent based on the routing rules shown. <span class="gold" id="routeScore">0/6 correct</span></p>
<div class="glass" style="font-size:13px;margin-bottom:12px">
  <strong>Routing Rules:</strong><br>
  1. Telegram messages with "/research" &rarr; <span style="color:var(--purple)">Research Agent</span><br>
  2. Discord messages &rarr; <span style="color:var(--cyan)">Default Agent</span><br>
  3. WhatsApp group messages &rarr; <span style="color:var(--dim)">/dev/null</span> (ignored)<br>
  4. Everything else &rarr; <span style="color:var(--cyan)">Default Agent</span>
</div>
<div class="drag-area">
  <div class="drag-col">
    <h4>Incoming Messages</h4>
    <div id="dragSource">
      <div class="drag-item" draggable="true" data-answer="default" ondragstart="dragStart(event)" id="dm0"><span class="channel-icon" style="background:var(--cyan)"></span>Telegram: "What's the weather?"</div>
      <div class="drag-item" draggable="true" data-answer="research" ondragstart="dragStart(event)" id="dm1"><span class="channel-icon" style="background:var(--cyan)"></span>Telegram: "/research quantum computing"</div>
      <div class="drag-item" draggable="true" data-answer="default" ondragstart="dragStart(event)" id="dm2"><span class="channel-icon" style="background:var(--purple)"></span>Discord: "Help me debug this"</div>
      <div class="drag-item" draggable="true" data-answer="null" ondragstart="dragStart(event)" id="dm3"><span class="channel-icon" style="background:var(--green)"></span>WhatsApp Group: "Hey everyone"</div>
      <div class="drag-item" draggable="true" data-answer="default" ondragstart="dragStart(event)" id="dm4"><span class="channel-icon" style="background:var(--green)"></span>WhatsApp DM: "Remind me tomorrow"</div>
      <div class="drag-item" draggable="true" data-answer="research" ondragstart="dragStart(event)" id="dm5"><span class="channel-icon" style="background:var(--cyan)"></span>Telegram: "/research best practices CI/CD"</div>
    </div>
  </div>
  <div class="drag-col">
    <h4>Agent Destinations</h4>
    <div class="drop-zone" data-target="default" ondrop="dropMsg(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)" style="border-color:var(--cyan);margin-bottom:10px">
      <div style="font-size:12px;color:var(--cyan);margin-bottom:4px">Default Agent</div>
    </div>
    <div class="drop-zone" data-target="research" ondrop="dropMsg(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)" style="border-color:var(--purple);margin-bottom:10px">
      <div style="font-size:12px;color:var(--purple);margin-bottom:4px">Research Agent</div>
    </div>
    <div class="drop-zone" data-target="null" ondrop="dropMsg(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)" style="border-color:var(--dim)">
      <div style="font-size:12px;color:var(--dim);margin-bottom:4px">/dev/null (Ignore)</div>
    </div>
  </div>
</div>
</div>

<!-- ======== SLIDE 5: AUTH PUZZLE ======== -->
<div class="slide" id="s7">
<h2>Hack the Gateway</h2>
<p>Solve all 5 authentication methods to gain access. <span class="gold" id="authScore">0/5 unlocked</span></p>
<div class="auth-doors" id="authDoors">
  <div class="auth-door" id="ad0">
    <div><h4>Token Auth</h4><div class="lock">&#x1f512;</div></div>
    <div><p style="font-size:11px;color:var(--dim)">The token is: <span id="tokenHint" style="color:var(--cyan)"></span></p>
    <input class="auth-input" placeholder="Enter bearer token..." id="tokenInput" onkeydown="if(event.key==='Enter')checkToken()">
    <button class="nav-btn" onclick="checkToken()" style="width:100%;margin-top:4px;font-size:11px">Submit</button></div>
  </div>
  <div class="auth-door" id="ad1">
    <div><h4>Password</h4><div class="lock">&#x1f512;</div></div>
    <div><p style="font-size:11px;color:var(--dim)">Hash: <span class="mono">$2b$10...xK9</span></p>
    <button class="auth-opt" onclick="checkPwd(this,false)">hunter2</button>
    <button class="auth-opt" onclick="checkPwd(this,true)">0p3nCl4w!</button>
    <button class="auth-opt" onclick="checkPwd(this,false)">password123</button>
    <button class="auth-opt" onclick="checkPwd(this,false)">admin</button></div>
  </div>
  <div class="auth-door" id="ad2">
    <div><h4>Tailscale</h4><div class="lock">&#x1f512;</div></div>
    <div><p style="font-size:11px;color:var(--dim)">Which IP is on the mesh?</p>
    <button class="auth-opt" onclick="checkTS(this,false)">8.8.8.8</button>
    <button class="auth-opt" onclick="checkTS(this,true)">100.75.169.95</button>
    <button class="auth-opt" onclick="checkTS(this,false)">192.168.1.1</button>
    <button class="auth-opt" onclick="checkTS(this,false)">10.0.0.1</button></div>
  </div>
  <div class="auth-door" id="ad3">
    <div><h4>Device Sig</h4><div class="lock">&#x1f512;</div></div>
    <div><p style="font-size:11px;color:var(--dim)">Order: timestamp, nonce, HMAC</p>
    <div id="sigSlots" style="min-height:70px">
      <div class="drag-item" draggable="true" data-sig="2" ondragstart="dragStart(event)" id="sig0" style="font-size:11px;padding:6px 8px">HMAC-SHA256</div>
      <div class="drag-item" draggable="true" data-sig="0" ondragstart="dragStart(event)" id="sig1" style="font-size:11px;padding:6px 8px">Timestamp</div>
      <div class="drag-item" draggable="true" data-sig="1" ondragstart="dragStart(event)" id="sig2" style="font-size:11px;padding:6px 8px">Nonce</div>
    </div>
    <button class="nav-btn" onclick="checkSig()" style="width:100%;font-size:11px">Verify</button></div>
  </div>
  <div class="auth-door" id="ad4">
    <div><h4>Loopback</h4><div class="lock">&#x1f512;</div></div>
    <div><p style="font-size:11px;color:var(--dim)">Local connections skip auth entirely.</p>
    <button class="auth-opt" onclick="checkLoop(this)" style="text-align:center;color:var(--cyan)">127.0.0.1</button></div>
  </div>
</div>
</div>

<!-- ======== SLIDE 6: LLM DEBUGGER ======== -->
<div class="slide" id="s8">
<h2>The LLM Loop – Step-Through Debugger</h2>
<p>Walk through a real agent interaction step by step. Click <strong>Step</strong> to advance, or set breakpoints by clicking a step.</p>
<div class="debugger">
  <div class="debug-toolbar">
    <button class="debug-btn" id="dbgStep" onclick="debugStep()">Step &rarr;</button>
    <button class="debug-btn" id="dbgCont" onclick="debugContinue()">Continue &raquo;</button>
    <button class="debug-btn" onclick="debugReset()">Reset</button>
    <span style="flex:1"></span>
    <span class="mono dim" style="font-size:11px" id="dbgStatus">Ready – Step 0/7</span>
  </div>
  <div class="debug-steps" id="dbgSteps">
    <div class="debug-step" data-i="0" onclick="toggleBP(this)">1. Receive user message: <span class="accent">"Create a file called hello.py"</span></div>
    <div class="debug-step" data-i="1" onclick="toggleBP(this)">2. Assemble context: system prompt + session history + 12 skills</div>
    <div class="debug-step" data-i="2" onclick="toggleBP(this)">3. Call LLM (Claude Opus) with context <span class="dim">(~4200 tokens)</span></div>
    <div class="debug-step" data-i="3" onclick="toggleBP(this)">4. Parse response &rarr; <span class="ember">tool_call: exec</span> <span class="mono dim">echo 'print("hello")' > hello.py</span></div>
    <div class="debug-step" data-i="4" onclick="toggleBP(this)">5. Execute bash tool &rarr; <span class="term-ok">exit code 0</span>, file created</div>
    <div class="debug-step" data-i="5" onclick="toggleBP(this)">6. Call LLM again with tool result <span class="dim">(+120 tokens)</span></div>
    <div class="debug-step" data-i="6" onclick="toggleBP(this)">7. Parse response &rarr; <span class="accent">text</span>: "I've created hello.py with a hello world script."</div>
  </div>
  <div class="debug-data" id="dbgData">Click Step to begin. Click any step number to set a breakpoint (red dot).</div>
</div>
<div class="insight"><div class="insight-label">The Core Loop</div>The agent calls the LLM, which may return text OR tool calls. If tool calls: execute the tool, feed the result back to the LLM, and loop. This continues until the LLM returns a text response (no tool calls). This loop is the heart of every agent interaction.</div>
</div>

<!-- ======== SLIDE 7: SKILLS ======== -->
<div class="slide" id="s9">
<h2>Skills System</h2>
<p>Skills are <strong>SKILL.md files</strong> that teach the agent new capabilities. Edit the skill below and see how the agent interprets it.</p>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0">
  <div>
    <div style="font-size:12px;color:var(--dim);margin-bottom:6px">SKILL.md Editor</div>
    <textarea id="skillEditor" style="width:100%;height:200px;background:var(--bg);border:1px solid var(--border);border-radius:3px;padding:12px;color:var(--text);font-family:'JetBrains Mono','SF Mono',monospace;font-size:12px;resize:none;outline:none" oninput="updateSkillPreview()">---
name: present
description: Create stunning interactive HTML presentations
---

# Present

Create presentations that make audiences say "how did they do that?"
Output a single self-contained HTML file.

## Requirements
- Keyboard navigation (arrow keys)
- Smooth transitions between slides
- Interactive elements (drag, click, type)
- Dark theme with glass morphism</textarea>
  </div>
  <div>
    <div style="font-size:12px;color:var(--dim);margin-bottom:6px">Agent Interpretation</div>
    <div class="glass" id="skillPreview" style="height:200px;overflow-y:auto;font-size:13px"></div>
  </div>
</div>
<h3>Skill Precedence</h3>
<p style="font-size:13px">When two skills have the same name, the <strong>higher level wins</strong>. Workspace overrides everything.</p>
<div style="display:flex;gap:8px;align-items:flex-end;margin:12px 0">
  <div style="flex:1;text-align:center">
    <div style="background:var(--bg2);border:1px solid var(--border);border-radius:3px;padding:10px;font-size:11px;min-height:50px"><span class="dim">Extra Dirs</span><br><span style="color:var(--dim)">Lowest</span></div>
  </div>
  <div style="flex:1;text-align:center">
    <div style="background:var(--bg2);border:1px solid var(--border);border-radius:3px;padding:10px;font-size:11px;min-height:50px"><span class="dim">Plugin</span></div>
  </div>
  <div style="flex:1;text-align:center">
    <div style="background:var(--bg2);border:1px solid var(--border);border-radius:3px;padding:10px;font-size:11px;min-height:50px"><span class="dim">Bundled</span><br><span style="font-size:10px;color:var(--ember)">present v1</span></div>
  </div>
  <div style="flex:1;text-align:center">
    <div style="background:var(--bg2);border:1px solid var(--border);border-radius:3px;padding:10px;font-size:11px;min-height:50px"><span class="dim">Managed</span><br><span style="font-size:10px;color:var(--cyan)">~/.openclaw/skills/</span></div>
  </div>
  <div style="flex:1;text-align:center">
    <div style="background:rgba(249,115,22,.06);border:1px solid var(--cyan);border-radius:3px;padding:10px;font-size:11px;min-height:50px"><strong class="accent">Workspace</strong><br><span style="font-size:10px;color:var(--gold)">present v2 WINS</span></div>
  </div>
</div>
</div>

<!-- ======== SLIDE 10: TOOL WORKBENCH ======== -->
<div class="slide" id="s10">
<h2>Tool Workbench</h2>
<p>The agent has 4 core tool types. Try each one — type commands, browse pages, manage files, or spawn sub-agents.</p>
<div class="wb-tabs">
  <span class="wb-tab active" onclick="switchWBTab(0,this)">Bash</span>
  <span class="wb-tab" onclick="switchWBTab(1,this)">Browser</span>
  <span class="wb-tab" onclick="switchWBTab(2,this)">Files</span>
  <span class="wb-tab" onclick="switchWBTab(3,this)">Sub-Agent</span>
</div>
<div class="wb-panel active" id="wbp0">
  <div class="wb-body" id="wbBash"><span class="term-prompt">$ </span><span class="dim">type a command...</span></div>
  <div class="wb-input"><span style="padding:8px 4px 8px 12px;color:var(--green)">$</span><input id="wbBashIn" placeholder="ls, pwd, echo, cat, date..." onkeydown="if(event.key==='Enter')runWBBash()"></div>
</div>
<div class="wb-panel" id="wbp1">
  <div class="wb-body" id="wbBrowser"><div style="background:var(--bg);border-radius:3px;padding:16px;text-align:center"><span class="dim">Mini viewport</span><div style="margin:12px 0;padding:12px;background:#fff;color:#000;border-radius:3px;font-size:13px" id="wbPage"><h3 style="margin:0 0 8px;color:#333">Example Page</h3><p style="margin:0;color:#666">The browser tool renders pages and extracts content.</p></div></div></div>
  <div class="wb-input"><input id="wbBrowseIn" placeholder="Enter URL to browse..." onkeydown="if(event.key==='Enter')runWBBrowse()"></div>
</div>
<div class="wb-panel" id="wbp2">
  <div class="wb-body" id="wbFiles"><div class="ftree-item ftree-folder" style="cursor:pointer" onclick="wbFileAction('ls')">workspace/</div><div class="ftree-item ftree-file" style="margin-left:16px;cursor:pointer" onclick="wbFileAction('read')">hello.py</div><div class="ftree-item ftree-file" style="margin-left:16px;cursor:pointer" onclick="wbFileAction('read2')">README.md</div></div>
  <div class="wb-input"><input id="wbFileIn" placeholder="create filename.ext or delete filename.ext" onkeydown="if(event.key==='Enter')runWBFile()"></div>
</div>
<div class="wb-panel" id="wbp3">
  <div class="wb-body" id="wbAgent"><span class="dim">Spawn a sub-agent to handle a complex sub-task.</span></div>
  <div class="wb-input"><input id="wbAgentIn" placeholder="Describe task for sub-agent..." onkeydown="if(event.key==='Enter')runWBAgent()"></div>
</div>
<div class="wb-counter">Tools used: <span id="wbToolCount">0</span> | Tokens consumed: <span id="wbTokenCount">0</span> | Est. cost: <span id="wbCost">$0.00</span></div>
</div>

<!-- ======== SLIDE 11: MULTI-AGENT ======== -->
<div class="slide" id="s11">
<h2>Multi-Agent Orchestration</h2>
<p>OpenClaw can route messages to different agents and spawn sub-agents. Select a scenario and click <strong>Run</strong> to watch.</p>
<div class="ma-scenarios">
  <button class="nav-btn" onclick="loadMA(0)" style="font-size:11px">Simple Delegation</button>
  <button class="nav-btn" onclick="loadMA(1)" style="font-size:11px">Parallel Fan-Out</button>
  <button class="nav-btn" onclick="loadMA(2)" style="font-size:11px">Chain Pipeline</button>
  <button class="nav-btn primary" onclick="runMA()" style="font-size:11px">Run</button>
</div>
<div class="ma-canvas" id="maCanvas"></div>
<div class="insight"><div class="insight-label">Agent Routing</div>The Gateway's routing engine matches incoming messages against rules (channel, pattern, user) and dispatches to the appropriate agent. Each agent has its own model, tools, skills, and workspace. Sub-agents inherit the parent's session but can use different models for cost/speed optimization.</div>
</div>

<!-- ======== SLIDE 12: FILE TREE ======== -->
<div class="slide" id="s12">
<h2>File-Based State</h2>
<p>Everything OpenClaw stores lives in <strong class="mono">~/.openclaw/</strong>. No database. Click any file to inspect it.</p>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin:16px 0">
<div class="ftree" id="fileTree"></div>
<div class="ftree-viewer" id="fileViewer" style="display:block"><span class="dim">Click a file in the tree to view its contents</span></div>
</div>
<div class="insight"><div class="insight-label">Why files, not a database?</div>
<strong>Simplicity.</strong> JSONL is append-only – writing a new message is just appending a line. No ORM, no migrations, no schema. You can inspect state with <span class="mono">cat</span>, back it up with <span class="mono">cp</span>, and version it with <span class="mono">git</span>. For a single-user system, this is the right tradeoff.</div>
</div>

<!-- ======== SLIDE 9: SESSION PLAYER ======== -->
<div class="slide" id="s13">
<h2>Session Transcript Replay</h2>
<p>Sessions are stored as <strong>JSONL</strong> (one JSON object per line). Use the player to step through a real session.</p>
<div class="player">
  <div class="player-display" id="playerDisplay"></div>
  <div class="player-controls">
    <button class="player-btn" id="playBtn" onclick="togglePlay()">&#9654; Play</button>
    <input type="range" class="player-timeline" id="playerTimeline" min="0" max="8" value="0" oninput="seekPlayer(this.value)">
    <div class="player-tokens" id="playerTokens">Tokens: 0 / 200k</div>
  </div>
</div>
</div>

<!-- ======== SLIDE 15: NETWORK TOPOLOGY ======== -->
<div class="slide" id="s14">
<h2>Network Topology</h2>
<p>Trace the full network path of a message — from a user's phone to the LLM and back. Click <strong>Trace</strong> to watch.</p>
<div class="topo-canvas" id="topoCanvas">
  <div class="topo-node" id="tp0" style="left:1%;top:40%">User Phone</div>
  <div class="topo-node" id="tp1" style="left:15%;top:20%">Telegram API</div>
  <div class="topo-node" id="tp2" style="left:15%;top:60%">WhatsApp Cloud</div>
  <div class="topo-node" id="tp3" style="left:32%;top:40%">Webhook</div>
  <div class="topo-node" id="tp4" style="left:48%;top:40%;color:var(--cyan)">OpenClaw Gateway</div>
  <div class="topo-node" id="tp5" style="left:65%;top:25%">Pi Agent</div>
  <div class="topo-node" id="tp6" style="left:65%;top:55%">Tool Executor</div>
  <div class="topo-node" id="tp7" style="left:82%;top:25%">Claude API</div>
  <div class="topo-node" id="tp8" style="left:82%;top:55%">Local Bash</div>
</div>
<button class="nav-btn primary" onclick="traceTopo()" style="margin:8px 0">Trace Message Path</button>
<div class="glass" id="topoInfo" style="display:none;font-size:12px"></div>
</div>

<!-- ======== SLIDE 16: WATERFALL ======== -->
<div class="slide" id="s15">
<h2>Message Lifecycle Waterfall</h2>
<p>Every phase of a message's lifecycle, from webhook receipt to response delivery. Click any row for details. Use the slider to simulate latency changes.</p>
<div style="font-size:12px;color:var(--dim);margin-bottom:8px">Latency multiplier: <span id="wfMultLabel">1.0x</span></div>
<input type="range" min="50" max="300" value="100" style="width:200px;margin-bottom:12px" oninput="updateWF(this.value)">
<div id="wfChart">
  <div class="wf-row" onclick="toggleWFDetail(0)"><div class="wf-label">Webhook Receipt</div><div class="wf-track"><div class="wf-bar" style="left:0%;width:3%;background:var(--green)" data-base-w="3" data-base-l="0">5ms</div></div></div>
  <div class="wf-detail" id="wfd0">Telegram/WhatsApp sends HTTP POST to your webhook URL. OpenClaw's Hono.js server receives and parses the JSON body. Near-instant on local network.</div>
  <div class="wf-row" onclick="toggleWFDetail(1)"><div class="wf-label">Channel Normalize</div><div class="wf-track"><div class="wf-bar" style="left:3%;width:2%;background:var(--ember)" data-base-w="2" data-base-l="3">3ms</div></div></div>
  <div class="wf-detail" id="wfd1">Channel plugin transforms platform-specific payload into OpenClaw's standard Message format. Extracts sender, text, media, metadata. Pure CPU work.</div>
  <div class="wf-row" onclick="toggleWFDetail(2)"><div class="wf-label">Gateway Route</div><div class="wf-track"><div class="wf-bar" style="left:5%;width:1%;background:var(--cyan)" data-base-w="1" data-base-l="5">2ms</div></div></div>
  <div class="wf-detail" id="wfd2">Routing engine evaluates message against rules (channel, pattern, user-ID) and selects target agent. Auth check if not loopback.</div>
  <div class="wf-row" onclick="toggleWFDetail(3)"><div class="wf-label">Context Assembly</div><div class="wf-track"><div class="wf-bar" style="left:6%;width:5%;background:var(--purple)" data-base-w="5" data-base-l="6">15ms</div></div></div>
  <div class="wf-detail" id="wfd3">Pi loads session JSONL, assembles system prompt + history + skills. May trigger compaction if near context limit. Reads from disk (SSD: &lt;1ms per file).</div>
  <div class="wf-row" onclick="toggleWFDetail(4)"><div class="wf-label">LLM API Call</div><div class="wf-track"><div class="wf-bar" style="left:11%;width:55%;background:var(--gold)" data-base-w="55" data-base-l="11">1200ms</div></div></div>
  <div class="wf-detail" id="wfd4">HTTPS POST to api.anthropic.com. This is the dominant latency — typically 800-3000ms depending on model, input size, and output length. First token streams in ~400ms.</div>
  <div class="wf-row" onclick="toggleWFDetail(5)"><div class="wf-label">Tool Execution</div><div class="wf-track"><div class="wf-bar" style="left:66%;width:8%;background:var(--ember)" data-base-w="8" data-base-l="66">50ms</div></div></div>
  <div class="wf-detail" id="wfd5">If LLM returns tool_call: execute bash/read/write/browser. Bash commands typically &lt;100ms. Browser tool can take 2-5s for page loads. Result fed back to LLM.</div>
  <div class="wf-row" onclick="toggleWFDetail(6)"><div class="wf-label">2nd LLM Call</div><div class="wf-track"><div class="wf-bar" style="left:74%;width:20%;background:var(--gold)" data-base-w="20" data-base-l="74">600ms</div></div></div>
  <div class="wf-detail" id="wfd6">Second LLM call with tool result appended. Usually faster since output is shorter (just text summary). Streams via chat.delta events.</div>
  <div class="wf-row" onclick="toggleWFDetail(7)"><div class="wf-label">Response Delivery</div><div class="wf-track"><div class="wf-bar" style="left:94%;width:4%;background:var(--green)" data-base-w="4" data-base-l="94">10ms</div></div></div>
  <div class="wf-detail" id="wfd7">Final text sent back through channel plugin → platform API → user's phone. JSONL transcript appended. Total: ~1.9s for a tool-using response.</div>
</div>
</div>

<!-- ======== SLIDE 17: PROVIDER ABSTRACTION ======== -->
<div class="slide" id="s16">
<h2>Provider Abstraction</h2>
<p>Same prompt, two models. Click <strong>Compare</strong> to see side-by-side results. Click <strong>Hot-Swap</strong> to switch models mid-conversation.</p>
<div style="margin-bottom:12px"><input class="api-search" id="provPrompt" value="Explain quantum entanglement in one paragraph." style="margin-bottom:8px">
<button class="nav-btn primary" onclick="runProvCompare()">Compare</button>
<button class="nav-btn" onclick="hotSwapProv()">Hot-Swap Mid-Conversation</button></div>
<div class="prov-compare">
  <div class="prov-panel">
    <div class="prov-header"><span style="color:var(--cyan)">Claude Opus 4.6</span><span class="dim">anthropic/claude-opus-4-6</span></div>
    <div class="prov-body" id="provA"><span class="dim">Click Compare...</span></div>
    <div class="prov-stats"><div><div class="dim">Tokens</div><div class="prov-stat-val" id="provATokens">—</div></div><div><div class="dim">Latency</div><div class="prov-stat-val" id="provALat">—</div></div><div><div class="dim">Cost</div><div class="prov-stat-val" id="provACost">—</div></div></div>
  </div>
  <div class="prov-panel">
    <div class="prov-header"><span style="color:var(--green)">GPT-4o</span><span class="dim">openai/gpt-4o</span></div>
    <div class="prov-body" id="provB"><span class="dim">Click Compare...</span></div>
    <div class="prov-stats"><div><div class="dim">Tokens</div><div class="prov-stat-val" id="provBTokens">—</div></div><div><div class="dim">Latency</div><div class="prov-stat-val" id="provBLat">—</div></div><div><div class="dim">Cost</div><div class="prov-stat-val" id="provBCost">—</div></div></div>
  </div>
</div>
<div class="insight"><div class="insight-label">Provider Layer</div>OpenClaw abstracts LLM providers behind a unified interface. You can switch models per-agent, per-request, or as fallbacks. The provider layer handles auth, streaming, token counting, and cost tracking for Claude, GPT, Gemini, Mistral, Groq, Ollama, and any OpenAI-compatible endpoint.</div>
</div>

<!-- ======== SLIDE 18: DOCKER LAYERS ======== -->
<div class="slide" id="s17">
<h2>Docker Architecture</h2>
<p>Stack the Dockerfile layers in the correct order. Wrong order = realistic build errors. <span class="gold" id="dockerScore">0/6 correct</span></p>
<div class="docker-area">
  <div class="docker-source">
    <div style="font-size:12px;color:var(--dim);margin-bottom:8px">Drag layers in order:</div>
    <div id="dockerLayers">
      <div class="docker-layer" draggable="true" data-order="2" id="dk0" ondragstart="dragStart(event)">COPY package*.json ./</div>
      <div class="docker-layer" draggable="true" data-order="5" id="dk1" ondragstart="dragStart(event)">EXPOSE 18789</div>
      <div class="docker-layer" draggable="true" data-order="0" id="dk2" ondragstart="dragStart(event)">FROM node:22-slim</div>
      <div class="docker-layer" draggable="true" data-order="4" id="dk3" ondragstart="dragStart(event)">COPY . .</div>
      <div class="docker-layer" draggable="true" data-order="3" id="dk4" ondragstart="dragStart(event)">RUN npm ci --production</div>
      <div class="docker-layer" draggable="true" data-order="1" id="dk5" ondragstart="dragStart(event)">WORKDIR /app</div>
    </div>
  </div>
  <div class="docker-target">
    <div style="font-size:12px;color:var(--dim);margin-bottom:8px">Dockerfile (top to bottom):</div>
    <div class="docker-slot" data-pos="0" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 1 — Base image</div>
    <div class="docker-slot" data-pos="1" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 2 — Working directory</div>
    <div class="docker-slot" data-pos="2" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 3 — Copy package manifest</div>
    <div class="docker-slot" data-pos="3" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 4 — Install dependencies</div>
    <div class="docker-slot" data-pos="4" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 5 — Copy source</div>
    <div class="docker-slot" data-pos="5" ondrop="dropDocker(event)" ondragover="dragOver(event)" ondragleave="dragLeave(event)">Layer 6 — Expose port</div>
    <div class="docker-error" id="dockerErr"></div>
  </div>
</div>
<div class="insight"><div class="insight-label">Layer Order Matters</div>Docker caches each layer. By copying <span class="mono">package.json</span> before the full source, the <span class="mono">npm ci</span> layer is cached unless dependencies change. This cuts rebuild time from minutes to seconds.</div>
</div>

<!-- ======== SLIDE 19: CHAOS ENGINEERING ======== -->
<div class="slide" id="s18">
<h2>Error Handling – Chaos Console</h2>
<p>Toggle failure injections and watch how OpenClaw responds. Multiple failures can be active simultaneously.</p>
<div class="chaos-grid">
  <div class="chaos-toggles">
    <div class="chaos-toggle"><span>LLM Timeout</span><div class="chaos-switch" id="chaos0" onclick="toggleChaos(0)"></div></div>
    <div class="chaos-toggle"><span>Channel Webhook Failure</span><div class="chaos-switch" id="chaos1" onclick="toggleChaos(1)"></div></div>
    <div class="chaos-toggle"><span>Disk Full</span><div class="chaos-switch" id="chaos2" onclick="toggleChaos(2)"></div></div>
    <div class="chaos-toggle"><span>Auth Token Expired</span><div class="chaos-switch" id="chaos3" onclick="toggleChaos(3)"></div></div>
    <div class="chaos-toggle"><span>Context Window Overflow</span><div class="chaos-switch" id="chaos4" onclick="toggleChaos(4)"></div></div>
  </div>
  <div class="chaos-log" id="chaosLog"><div class="dim">Toggle a failure to see the system response...</div></div>
</div>
</div>

<!-- ======== SLIDE 11: SANDBOX ======== -->
<div class="slide" id="s19">
<h2>Full System Sandbox</h2>
<p>Type a message and watch all layers of OpenClaw respond in real-time.</p>
<div class="sandbox" id="sandbox">
  <div class="sandbox-panel">
    <div class="sandbox-header">Chat</div>
    <div class="sandbox-body" id="sbChat"></div>
    <div class="sandbox-input"><input id="sbInput" placeholder="Type a message..." onkeydown="if(event.key==='Enter')sendSandbox()"><button onclick="sendSandbox()">Send</button></div>
  </div>
  <div class="sandbox-panel">
    <div class="sandbox-header">Gateway Log</div>
    <div class="sandbox-body" id="sbGateway"><span class="dim">[ready] Listening on ws://0.0.0.0:18789</span></div>
  </div>
  <div class="sandbox-panel">
    <div class="sandbox-header">Agent Runtime</div>
    <div class="sandbox-body" id="sbAgent"><span class="dim">[idle] Waiting for messages...</span></div>
  </div>
  <div class="sandbox-panel">
    <div class="sandbox-header">File System</div>
    <div class="sandbox-body" id="sbFS"><span class="dim">~/.openclaw/workspace/agents/default/sessions/</span></div>
  </div>
</div>
</div>

<!-- ======== SLIDE 12: QUIZ ======== -->
<div class="slide" id="s20">
<h2>Test Your Understanding</h2>
<p>10 questions covering the full architecture. <span class="gold" id="quizTotal">0/10 correct</span></p>

<div class="quiz" id="q0">
  <div class="quiz-q">Q1: What protocol does the Gateway primarily use for real-time communication?</div>
  <button class="quiz-opt" onclick="answer('q0',this,false)">HTTP REST API</button>
  <button class="quiz-opt" onclick="answer('q0',this,true)">WebSocket (JSON-RPC-like frames on port 18789)</button>
  <button class="quiz-opt" onclick="answer('q0',this,false)">gRPC with Protocol Buffers</button>
  <button class="quiz-opt" onclick="answer('q0',this,false)">GraphQL subscriptions</button>
  <div class="quiz-fb" id="q0fb"></div>
</div>

<div class="quiz" id="q1">
  <div class="quiz-q">Q2: How does OpenClaw store session transcripts?</div>
  <button class="quiz-opt" onclick="answer('q1',this,false)">PostgreSQL database with message table</button>
  <button class="quiz-opt" onclick="answer('q1',this,false)">Redis for in-memory caching with periodic snapshots</button>
  <button class="quiz-opt" onclick="answer('q1',this,true)">JSONL files (one JSON object per line, append-only)</button>
  <button class="quiz-opt" onclick="answer('q1',this,false)">SQLite with FTS5 for full-text search</button>
  <div class="quiz-fb" id="q1fb"></div>
</div>

<div class="quiz" id="q2">
  <div class="quiz-q">Q3: What happens when an agent's LLM response contains a tool call?</div>
  <button class="quiz-opt" onclick="answer('q2',this,false)">The tool call is queued for manual approval</button>
  <button class="quiz-opt" onclick="answer('q2',this,true)">The tool executes, the result is fed back to the LLM, and the loop continues</button>
  <button class="quiz-opt" onclick="answer('q2',this,false)">The tool call is sent to the user for execution</button>
  <button class="quiz-opt" onclick="answer('q2',this,false)">A separate tool-execution microservice handles it asynchronously</button>
  <div class="quiz-fb" id="q2fb"></div>
</div>

<div class="quiz" id="q3">
  <div class="quiz-q">Q4: Which auth method requires zero credentials for local connections?</div>
  <button class="quiz-opt" onclick="answer('q3',this,false)">Token auth with empty string</button>
  <button class="quiz-opt" onclick="answer('q3',this,false)">Tailscale identity</button>
  <button class="quiz-opt" onclick="answer('q3',this,true)">Loopback bypass (127.0.0.1 auto-approved)</button>
  <button class="quiz-opt" onclick="answer('q3',this,false)">Device signature with default key</button>
  <div class="quiz-fb" id="q3fb"></div>
</div>

<div class="quiz" id="q4">
  <div class="quiz-q">Q5: In the skill precedence hierarchy, which level wins when names conflict?</div>
  <button class="quiz-opt" onclick="answer('q4',this,false)">Bundled skills (shipped with OpenClaw)</button>
  <button class="quiz-opt" onclick="answer('q4',this,false)">Plugin-provided skills</button>
  <button class="quiz-opt" onclick="answer('q4',this,false)">Managed skills (~/.openclaw/skills/)</button>
  <button class="quiz-opt" onclick="answer('q4',this,true)">Workspace skills (highest precedence)</button>
  <div class="quiz-fb" id="q4fb"></div>
</div>

<div class="quiz" id="q5">
  <div class="quiz-q">Q6: What does a Channel plugin do?</div>
  <button class="quiz-opt" onclick="answer('q5',this,true)">Receives raw webhooks from a platform and normalizes them into a standard Message format</button>
  <button class="quiz-opt" onclick="answer('q5',this,false)">Stores messages in the session transcript</button>
  <button class="quiz-opt" onclick="answer('q5',this,false)">Executes tool calls on behalf of the agent</button>
  <button class="quiz-opt" onclick="answer('q5',this,false)">Manages authentication tokens for the platform</button>
  <div class="quiz-fb" id="q5fb"></div>
</div>

<div class="quiz" id="q6">
  <div class="quiz-q">Q7: How many API methods does the Gateway expose?</div>
  <button class="quiz-opt" onclick="answer('q6',this,false)">~15 core methods</button>
  <button class="quiz-opt" onclick="answer('q6',this,false)">~40 methods</button>
  <button class="quiz-opt" onclick="answer('q6',this,true)">80+ methods (chat, session, agent, config, channel, cron, skills, etc.)</button>
  <button class="quiz-opt" onclick="answer('q6',this,false)">~200 methods</button>
  <div class="quiz-fb" id="q6fb"></div>
</div>

<div class="quiz" id="q7">
  <div class="quiz-q">Q8: What is the Pi agent's relationship to OpenClaw?</div>
  <button class="quiz-opt" onclick="answer('q7',this,false)">Pi is a separate service that OpenClaw communicates with via API</button>
  <button class="quiz-opt" onclick="answer('q7',this,true)">Pi is the embedded agent runtime that OpenClaw uses to execute LLM calls and tools</button>
  <button class="quiz-opt" onclick="answer('q7',this,false)">Pi is the name of OpenClaw's CLI interface</button>
  <button class="quiz-opt" onclick="answer('q7',this,false)">Pi is the mobile app that connects to OpenClaw</button>
  <div class="quiz-fb" id="q7fb"></div>
</div>

<div class="quiz" id="q8">
  <div class="quiz-q">Q9: What language is OpenClaw built in?</div>
  <button class="quiz-opt" onclick="answer('q8',this,false)">Python with FastAPI</button>
  <button class="quiz-opt" onclick="answer('q8',this,false)">Rust with Actix</button>
  <button class="quiz-opt" onclick="answer('q8',this,true)">TypeScript on Node.js 22+ (~470k lines)</button>
  <button class="quiz-opt" onclick="answer('q8',this,false)">Go with standard library</button>
  <div class="quiz-fb" id="q8fb"></div>
</div>

<div class="quiz" id="q9">
  <div class="quiz-q">Q10: What happens when you toggle "LLM Timeout" in a chaos scenario?</div>
  <button class="quiz-opt" onclick="answer('q9',this,false)">The system crashes and requires restart</button>
  <button class="quiz-opt" onclick="answer('q9',this,false)">The message is silently dropped</button>
  <button class="quiz-opt" onclick="answer('q9',this,true)">Retry with exponential backoff, then fallback to a secondary model</button>
  <button class="quiz-opt" onclick="answer('q9',this,false)">An error is logged but no recovery is attempted</button>
  <div class="quiz-fb" id="q9fb"></div>
</div>

<div id="quizResult" style="display:none;margin-top:20px;padding:24px;background:var(--bg2);border-radius:3px;border:1px solid var(--border);text-align:center">
  <div style="font-size:20px;font-weight:600" id="quizResultText"></div>
  <div style="color:var(--dim);margin-top:8px" id="quizResultMsg"></div>
</div>
</div>

<!-- ======== SLIDE 13: GRADUATION ======== -->
<div class="slide" id="s21">
<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:calc(100vh - 140px);text-align:center">
<h1>Architecture Mastery</h1>
<p class="sub">You've explored the full OpenClaw stack</p>
<div style="margin:24px 0;font-size:48px" id="gradScore"></div>
<p>From messaging apps through channels, the gateway, agent runtime, tools, skills, sessions, and deployment – you now understand how every layer connects.</p>
<div style="margin-top:32px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
  <button class="nav-btn" onclick="goTo(0)">Replay from Start</button>
  <button class="nav-btn" onclick="goTo(3)">WebSocket Inspector</button>
  <button class="nav-btn" onclick="goTo(6)">LLM Debugger</button>
  <button class="nav-btn" onclick="goTo(11)">Sandbox</button>
</div>
</div>
</div>

</div><!-- end slide-wrap -->

<script>
// ========== STATE ==========
const TOTAL = 22;
let cur = 0, visited = new Set([0]), score = 0, maxScore = 100;
document.getElementById('scoreMax').textContent = maxScore;

// ========== NAV ==========
function buildNav(){const d=document.getElementById('navDots');for(let i=0;i<TOTAL;i++){const dot=document.createElement('div');dot.className='nav-dot'+(i===0?' active':'');dot.onclick=()=>goTo(i);d.appendChild(dot);}}
function goTo(n){if(n<0||n>=TOTAL)return;document.querySelectorAll('.slide').forEach(s=>s.classList.remove('active'));document.getElementById('s'+n).classList.add('active');visited.add(cur);cur=n;visited.add(n);document.querySelectorAll('.nav-dot').forEach((d,i)=>{d.className='nav-dot';if(i===n)d.classList.add('active');else if(visited.has(i))d.classList.add('visited');});document.getElementById('prevBtn').disabled=n===0;document.getElementById('nextBtn').disabled=n===TOTAL-1;document.getElementById('progressFill').style.width=((n/(TOTAL-1))*100)+'%';document.getElementById('slideWrap').scrollTop=0;if(n===21)showGrad();}
function go(d){goTo(cur+d);}
document.addEventListener('keydown',e=>{if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA')return;if(e.key==='ArrowRight'||e.key===' ')go(1);if(e.key==='ArrowLeft')go(-1);});
function addScore(n){score+=n;document.getElementById('scoreVal').textContent=score;}

// ========== SLIDE 0: BOOT ==========
let booted=false;
document.getElementById('bootInput').addEventListener('keydown',function(e){
  if(e.key==='Enter'&&!booted){
    const v=this.value.trim().toLowerCase();
    if(v==='openclaw gateway'||v==='openclaw start'){
      booted=true;this.disabled=true;
      const body=document.getElementById('bootBody');
      const lines=[
        {t:'[OK] Configuration loaded from ~/.openclaw/openclaw.json',c:'term-ok',d:200},
        {t:'[OK] Gateway WebSocket server starting on port 18789',c:'term-ok',d:350},
        {t:'[OK] HTTP server bound to 0.0.0.0:18789',c:'term-ok',d:150},
        {t:'[OK] Channel: Telegram connected (grammy v1.40)',c:'term-ok',d:300},
        {t:'[OK] Channel: WhatsApp connected (Baileys 7.0)',c:'term-ok',d:250},
        {t:'[OK] Channel: Discord connected (discord.js)',c:'term-ok',d:200},
        {t:'[OK] Channel: iMessage connected (BlueBubbles)',c:'term-ok',d:180},
        {t:'[OK] Agent Runtime: Pi initialized (Claude Opus 4.6)',c:'term-ok',d:400},
        {t:'[OK] Skills: 54 skills loaded (workspace > managed > bundled)',c:'term-ok',d:250},
        {t:'[OK] Auth: token + tailscale enabled',c:'term-ok',d:150},
        {t:'[OK] Cron service started (3 jobs)',c:'term-ok',d:180},
        {t:'[OK] Bonjour discovery active',c:'term-ok',d:120},
        {t:'',c:'',d:100},
        {t:'Gateway ready. Listening on ws://0.0.0.0:18789',c:'term-hl',d:0},
        {t:'Press → to begin the masterclass.',c:'term-out',d:0},
      ];
      let delay=100;
      lines.forEach(l=>{delay+=l.d;setTimeout(()=>{const div=document.createElement('div');div.className=l.c;div.textContent=l.t;body.appendChild(div);body.scrollTop=body.scrollHeight;},delay);});
      addScore(3);
    }else{
      const div=document.createElement('div');div.className='term-err';div.textContent='Command not found: '+v+'. Try "openclaw gateway"';document.getElementById('bootBody').appendChild(div);this.value='';
    }
  }
  if(e.key==='Tab'){e.preventDefault();this.value='openclaw gateway';}
});

// ========== SLIDE 1: DEPTH ==========
function updateDepth(v){
  const labels=['External Layer – Messaging Apps','Channel Layer – Normalization','Gateway – Central Hub','Agent Runtime – Pi Engine','State Layer – File Persistence'];
  const pct=parseInt(v);
  const layerIdx=Math.min(4,Math.floor(pct/20));
  document.getElementById('depthLabel').textContent=labels[layerIdx]+' — '+pct+'%';
  for(let i=0;i<=4;i++){
    const el=document.getElementById('dl'+i);
    if(i<=layerIdx){el.classList.add('visible');el.classList.remove('hidden');}
    else{el.classList.remove('visible');el.classList.add('hidden');}
  }
  if(!window._depthScored&&pct>80){window._depthScored=true;addScore(2);}
}

// ========== SLIDE 2: TRACE ==========
const traceData=[
  {title:'WhatsApp Webhook',data:'{\n  "entry": [{\n    "changes": [{\n      "value": {\n        "messages": [{\n          "from": "+1234567890",\n          "type": "text",\n          "text": {"body":"Create hello.py"}\n        }]\n      }\n    }]\n  }]\n}'},
  {title:'Normalized Message',data:'{\n  "sender": "+1234567890",\n  "channel": "whatsapp",\n  "text": "Create hello.py",\n  "timestamp": "2026-02-10T14:30:00Z",\n  "mediaType": null\n}'},
  {title:'Gateway Routing Decision',data:'{\n  "route": "default",\n  "agentId": "default",\n  "sessionKey": "whatsapp:+1234567890:main",\n  "auth": "approved (loopback)",\n  "method": "chat.send"\n}'},
  {title:'Pi Agent Context',data:'{\n  "systemPrompt": "[1200 tokens]",\n  "sessionHistory": "[3 prior messages]",\n  "skills": ["present","coding-agent","github"],\n  "model": "claude-opus-4-6",\n  "tools": ["exec","read","write","edit","browser"]\n}'},
  {title:'LLM Response (Tool Call)',data:'{\n  "type": "tool_use",\n  "name": "exec",\n  "input": {\n    "command": "echo print(hello world) > hello.py"\n  }\n}'},
  {title:'Tool Execution Result',data:'{\n  "tool": "exec",\n  "exitCode": 0,\n  "stdout": "",\n  "stderr": "",\n  "duration_ms": 12\n}'}
];
let traceRunning=false;
function runTrace(){
  if(traceRunning)return;traceRunning=true;
  const p=document.getElementById('traceP');p.style.display='block';
  const nodes=[0,1,2,3,4,5,3,2,1,0];
  let i=0;
  function moveNext(){
    if(i>=nodes.length){traceRunning=false;p.style.display='none';addScore(3);return;}
    const n=document.getElementById('tn'+nodes[i]);
    const r=n.getBoundingClientRect();const c=document.getElementById('traceCanvas').getBoundingClientRect();
    p.style.left=(r.left-c.left+r.width/2-6)+'px';p.style.top=(r.top-c.top+r.height/2-6)+'px';
    n.classList.add('lit');
    if(nodes[i]!==nodes[Math.max(0,i-1)]){setTimeout(()=>n.classList.remove('lit'),800);}
    i++;setTimeout(moveNext,500);
  }
  moveNext();
}
function inspectTrace(idx){
  if(idx>=traceData.length)return;
  const insp=document.getElementById('traceInsp');insp.classList.add('show');
  document.getElementById('traceInspTitle').textContent='Stage '+(idx+1)+': '+traceData[idx].title;
  document.getElementById('traceInspBody').textContent=traceData[idx].data;
  addScore(1);
}

// ========== SLIDE 3: FRAME INSPECTOR ==========
const frameTypes=['auth','chat','chat','tool','sys','chat','tool','sys','chat','chat'];
const frameDefs={
  auth:{badge:'auth',summary:'connect → auth token validated',detail:'{\n  "type": "request",\n  "id": "req_001",\n  "method": "connect",\n  "params": {\n    "token": "oc_pat_...redacted...",\n    "clientId": "cli_macbook",\n    "version": "2026.2.9",\n    "role": "operator"\n  }\n}\n\nResponse:\n{\n  "type": "response",\n  "id": "req_001",\n  "result": {\n    "ok": true,\n    "method": "token",\n    "scopes": ["operator.admin","operator.write","operator.read"]\n  }\n}'},
  chat:{badge:'chat',summary:'chat.send → "What is quantum computing?"',detail:'{\n  "type": "request",\n  "id": "req_042",\n  "method": "chat.send",\n  "params": {\n    "sessionKey": "default:session:main",\n    "message": {\n      "role": "user",\n      "content": "What is quantum computing?"\n    }\n  }\n}\n\nEvents streamed:\n  chat.delta → {"token": "Quantum"}\n  chat.delta → {"token": " computing"}\n  chat.delta → {"token": " is..."}\n\nFinal response:\n{\n  "type": "response",\n  "id": "req_042",\n  "result": {"messageId": "msg_abc123"}  \n}'},
  tool:{badge:'tool',summary:'tool_call → exec: ls -la /workspace',detail:'{\n  "type": "event",\n  "event": "agent.tool_call",\n  "payload": {\n    "sessionKey": "default:session:main",\n    "tool": "exec",\n    "input": {\n      "command": "ls -la /workspace",\n      "timeout": 30000\n    },\n    "status": "running"\n  }\n}\n\nResult event:\n{\n  "type": "event",\n  "event": "agent.tool_result",  \n  "payload": {\n    "tool": "exec",\n    "exitCode": 0,\n    "stdout": "total 24\\ndrwxr-xr-x  5 user staff  160 Feb 10 14:30 .\\n...",\n    "duration_ms": 45\n  }\n}'},
  sys:{badge:'sys',summary:'heartbeat → ping/pong',detail:'{\n  "type": "event",\n  "event": "heartbeat",\n  "payload": {\n    "timestamp": "2026-02-10T14:30:15Z",\n    "uptime_s": 86423,\n    "connections": 3,\n    "activeChats": 1\n  }\n}'},
  err:{badge:'err',summary:'MALFORMED FRAME → parse error',detail:'Raw bytes: 7b 22 74 79 70 65 22 3a 20 22 72 65 71\n\nDecoded: {"type": "req   ← TRUNCATED\n\nError:\n{\n  "type": "error",\n  "code": -32700,\n  "message": "Parse error: Unexpected end of JSON input",\n  "handling": "Frame dropped. Connection preserved.\\nMalformed frames do not terminate the WebSocket.\\nThe client is notified via error event."\n}'}
};
let frameFilter='all',frameIdx=0;
function addFrame(type){
  const log=document.getElementById('frameLog');
  const f=frameDefs[type];
  const div=document.createElement('div');
  div.className='frame-entry';div.dataset.type=type;div.dataset.idx=frameIdx++;
  div.innerHTML=`<span class="frame-badge ${f.badge}">${type}</span><span class="dim" style="font-size:11px">${f.summary}</span>`;
  div.onclick=function(){
    document.querySelectorAll('.frame-entry').forEach(e=>e.classList.remove('selected'));
    this.classList.add('selected');
    document.getElementById('frameDetail').innerHTML='<pre style="white-space:pre-wrap;font-size:12px;color:var(--text);margin:0">'+f.detail+'</pre>';
    addScore(1);
  };
  if(frameFilter!=='all'&&type!==frameFilter)div.style.display='none';
  log.appendChild(div);log.scrollTop=log.scrollHeight;
}
function filterFrames(type,btn){
  frameFilter=type;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('.frame-entry').forEach(e=>{
    e.style.display=(type==='all'||e.dataset.type===type)?'flex':'none';
  });
}
function injectCorrupt(){addFrame('err');addScore(2);}
let frameInterval;
function startFrames(){
  frameInterval=setInterval(()=>{
    const t=frameTypes[Math.floor(Math.random()*frameTypes.length)];
    addFrame(t);
  },1200);
}

// ========== SLIDE 4: DRAG ROUTING ==========
let routeCorrect=0;
function dragStart(e){e.dataTransfer.setData('text/plain',e.target.id);e.target.classList.add('dragging');}
function dragOver(e){e.preventDefault();e.currentTarget.classList.add('over');}
function dragLeave(e){e.currentTarget.classList.remove('over');}
function dropMsg(e){
  e.preventDefault();e.currentTarget.classList.remove('over');
  const id=e.dataTransfer.getData('text/plain');const item=document.getElementById(id);
  if(!item||!item.dataset.answer)return;
  const target=e.currentTarget.dataset.target;
  const correct=item.dataset.answer===target;
  item.classList.remove('dragging');
  item.classList.add(correct?'correct':'wrong');
  item.draggable=false;
  if(correct){routeCorrect++;addScore(2);}
  else{setTimeout(()=>item.classList.remove('wrong'),600);}
  document.getElementById('routeScore').textContent=routeCorrect+'/6 correct';
}

// ========== SLIDE 5: AUTH ==========
let authSolved=0;
function authWin(idx){
  const d=document.getElementById('ad'+idx);d.classList.add('solved');
  d.querySelector('.lock').innerHTML='&#x1f513;';
  authSolved++;addScore(2);
  document.getElementById('authScore').textContent=authSolved+'/5 unlocked';
}
// Token
const token='oc_'+Math.random().toString(36).slice(2,10);
document.getElementById('tokenHint').textContent=token;
setTimeout(()=>{document.getElementById('tokenHint').style.display='none';},3000);
function checkToken(){if(document.getElementById('tokenInput').value===token)authWin(0);else document.getElementById('tokenInput').style.borderColor='var(--red)';}
function checkPwd(el,ok){el.classList.add(ok?'correct':'wrong');if(ok)authWin(1);el.parentElement.querySelectorAll('.auth-opt').forEach(b=>b.disabled=true);}
function checkTS(el,ok){el.classList.add(ok?'correct':'wrong');if(ok)authWin(2);el.parentElement.querySelectorAll('.auth-opt').forEach(b=>b.disabled=true);}
function checkSig(){
  const slots=document.getElementById('sigSlots');
  const items=[...slots.querySelectorAll('.drag-item')];
  const order=items.map(i=>parseInt(i.dataset.sig));
  if(order[0]===0&&order[1]===1&&order[2]===2)authWin(3);
  else items.forEach(i=>i.classList.add('wrong'));
  setTimeout(()=>items.forEach(i=>i.classList.remove('wrong')),600);
}
function checkLoop(el){el.classList.add('correct');authWin(4);}

// ========== SLIDE 6: DEBUGGER ==========
let dbgCur=-1;const dbgTotal=7;
const dbgDataContent=[
  'User input:\n"Create a file called hello.py"\n\nChannel: Telegram DM\nSession: default:session:main',
  'System prompt: [1200 tokens]\n  "You are an AI coding agent with access to tools..."\n\nSession history: 3 prior messages [850 tokens]\n\nSkills loaded:\n  - coding-agent (workspace)\n  - present (managed)\n  - github (bundled)\n  + 9 more\n\nTotal context: ~4200 tokens',
  'API Call → POST https://api.anthropic.com/v1/messages\n\nModel: claude-opus-4-6\nMax tokens: 8192\nTools: [exec, read, write, edit, browser, web_fetch]\n\nRequest size: 4200 tokens\nLatency: 1.8s',
  'Response parsed:\n{\n  "type": "tool_use",\n  "name": "exec",\n  "input": {\n    "command": "echo print(hello world) > hello.py"\n  }\n}\n\nDecision: TOOL CALL (not text) → execute and loop',
  'Tool: exec\nCommand: echo "print(hello world)" > hello.py\nTimeout: 30s\n\nResult:\n  exit_code: 0\n  stdout: ""\n  stderr: ""\n  duration: 12ms\n\nFile created: /workspace/hello.py',
  'Second LLM call:\n  Previous context: 4200 tokens\n  + Tool call: 80 tokens\n  + Tool result: 120 tokens\n  = Total: 4400 tokens\n\nLatency: 0.9s (shorter — less to generate)',
  'Final response:\n  "I\'ve created hello.py with a hello world script."\n\nTokens used: 4400 input + 42 output = 4442 total\nCost: ~$0.02\n\nResponse streamed via chat.delta events (5 chunks)'
];
function debugStep(){
  if(dbgCur>=dbgTotal-1)return;
  dbgCur++;
  const steps=document.querySelectorAll('.debug-step');
  steps.forEach((s,i)=>{s.classList.remove('current');if(i<dbgCur)s.classList.add('done');if(i===dbgCur)s.classList.add('current');});
  document.getElementById('dbgData').textContent=dbgDataContent[dbgCur];
  document.getElementById('dbgStatus').textContent='Step '+(dbgCur+1)+'/'+dbgTotal;
  addScore(1);
}
function debugContinue(){
  const steps=document.querySelectorAll('.debug-step');
  const interval=setInterval(()=>{
    if(dbgCur>=dbgTotal-1){clearInterval(interval);return;}
    const nextBP=[...steps].findIndex((s,i)=>i>dbgCur&&s.classList.contains('bp'));
    dbgCur++;
    steps.forEach((s,i)=>{s.classList.remove('current');if(i<dbgCur)s.classList.add('done');if(i===dbgCur)s.classList.add('current');});
    document.getElementById('dbgData').textContent=dbgDataContent[dbgCur];
    document.getElementById('dbgStatus').textContent='Step '+(dbgCur+1)+'/'+dbgTotal;
    if(nextBP===dbgCur)clearInterval(interval);
  },400);
}
function debugReset(){dbgCur=-1;document.querySelectorAll('.debug-step').forEach(s=>{s.classList.remove('current','done');});document.getElementById('dbgData').textContent='Click Step to begin.';document.getElementById('dbgStatus').textContent='Ready – Step 0/'+dbgTotal;}
function toggleBP(el){el.classList.toggle('bp');}

// ========== SLIDE 7: SKILLS EDITOR ==========
function updateSkillPreview(){
  const txt=document.getElementById('skillEditor').value;
  const nameMatch=txt.match(/name:\s*(.+)/);
  const descMatch=txt.match(/description:\s*(.+)/);
  const name=nameMatch?nameMatch[1].trim():'(unnamed)';
  const desc=descMatch?descMatch[1].trim():'(no description)';
  const body=txt.replace(/---[\s\S]*?---/,'').trim();
  const lines=body.split('\n').filter(l=>l.trim()).slice(0,6);
  document.getElementById('skillPreview').innerHTML=
    `<div style="margin-bottom:10px"><strong class="accent">/${name}</strong><br><span class="dim" style="font-size:12px">${desc}</span></div>`+
    `<div style="font-size:12px;color:var(--dim)">Injected into system prompt as:</div>`+
    `<div class="mono" style="font-size:11px;margin-top:6px;padding:10px;background:var(--bg);border-radius:3px;line-height:1.6">${lines.map(l=>'<div>'+l.replace(/</g,'&lt;')+'</div>').join('')}</div>`;
}

// ========== SLIDE 8: FILE TREE ==========
const fileTreeData={
  '~/.openclaw/':{type:'dir',children:{
    'openclaw.json':{type:'file',content:'// OpenClaw Configuration (JSON5)\n{\n  // Gateway settings\n  gateway: {\n    port: 18789,          // WebSocket + HTTP port\n    host: "0.0.0.0",      // Bind address\n    auth: {\n      token: "oc_pat_...",  // Bearer token\n      allowTailscale: true  // Tailscale identity auth\n    }\n  },\n\n  // Agent configuration\n  agents: {\n    list: [{\n      id: "default",\n      name: "Assistant",\n      model: "anthropic/claude-opus-4-6",\n      workspace: "/Users/openclaw/workspace",\n      skills: ["*"],       // All skills enabled\n    }]\n  },\n\n  // Channel connections\n  channels: {\n    telegram: { token: "bot_..." },\n    whatsapp: { enabled: true },\n    discord: { token: "disc_..." }\n  }\n}'},
    'workspace/':{type:'dir',children:{
      'agents/':{type:'dir',children:{
        'default/':{type:'dir',children:{
          'system.md':{type:'file',content:'# Default Agent\n\nYou are a helpful AI assistant running on OpenClaw.\nYou have access to tools for file operations, shell commands,\nbrowser automation, and web search.\n\nAlways be concise and accurate.'},
          'sessions/':{type:'dir',children:{
            'session-001.jsonl':{type:'file',content:'{"type":"session","version":1,"id":"session-001","timestamp":"2026-02-10T10:00:00Z"}\n{"role":"user","content":"What time is it?","timestamp":"2026-02-10T10:00:01Z"}\n{"role":"assistant","content":"Let me check...","timestamp":"2026-02-10T10:00:02Z"}\n{"role":"tool_call","name":"exec","input":{"command":"date"},"timestamp":"2026-02-10T10:00:02Z"}\n{"role":"tool_result","content":"Mon Feb 10 10:00:02 PST 2026","timestamp":"2026-02-10T10:00:02Z"}\n{"role":"assistant","content":"It\'s Monday, February 10, 2026 at 10:00 AM PST.","timestamp":"2026-02-10T10:00:03Z"}'},
          }}
        }}
      }}
    }},
    'skills/':{type:'dir',children:{
      'present/':{type:'dir',children:{
        'SKILL.md':{type:'file',content:'---\nname: present\ndescription: Create interactive HTML presentations\n---\n\n# Present\n\nCreate stunning presentations as single HTML files.\nOutput: one self-contained HTML file with all CSS and JS inline.'}
      }}
    }},
    'cron.json':{type:'file',content:'[\n  {\n    "id": "daily-summary",\n    "schedule": "0 9 * * 1-5",\n    "agent": "default",\n    "message": "Generate my daily summary"\n  }\n]'},
    'device-auth.json':{type:'file',content:'{\n  "devices": [\n    {\n      "id": "iphone-14-pro",\n      "name": "Mike\'s iPhone",\n      "paired": "2026-01-15T10:00:00Z",\n      "lastSeen": "2026-02-10T14:30:00Z"\n    }\n  ]\n}'}
  }}
};
function renderTree(data,depth=0){
  let html='';
  for(const[name,info]of Object.entries(data)){
    const indent='&nbsp;'.repeat(depth*4);
    if(info.type==='dir'){
      html+=`<div class="ftree-item ftree-folder">${indent}${name}</div>`;
      if(info.children)html+=renderTree(info.children,depth+1);
    }else{
      html+=`<div class="ftree-item ftree-file" onclick="viewFile(this)" data-content="${encodeURIComponent(info.content)}">${indent}${name}</div>`;
    }
  }
  return html;
}
function viewFile(el){
  const content=decodeURIComponent(el.dataset.content);
  const viewer=document.getElementById('fileViewer');
  viewer.style.display='block';
  viewer.innerHTML='<span style="color:var(--cyan);font-size:11px">'+el.textContent.trim()+'</span>\n\n'+content.replace(/</g,'&lt;');
  addScore(1);
}

// ========== SLIDE 9: SESSION PLAYER ==========
const sessionEntries=[
  {role:'system',content:'Session started. Agent: default. Model: claude-opus-4-6',tokens:50},
  {role:'user',content:'Can you list the files in my workspace?',tokens:120},
  {role:'assistant',content:'I\'ll check your workspace directory.',tokens:180},
  {role:'tool-call',content:'exec: ls -la /workspace',tokens:200},
  {role:'tool-result',content:'total 24\ndrwxr-xr-x  5 user staff  160 Feb 10 .\n-rw-r--r--  1 user staff  127 Feb 10 hello.py\n-rw-r--r--  1 user staff  890 Feb 10 README.md\ndrwxr-xr-x  3 user staff   96 Feb 10 src/',tokens:350},
  {role:'assistant',content:'Your workspace contains:\n- hello.py (127 bytes)\n- README.md (890 bytes)\n- src/ directory\n\nWould you like me to look at any of these files?',tokens:520},
  {role:'user',content:'Show me hello.py',tokens:560},
  {role:'tool-call',content:'read: /workspace/hello.py',tokens:580},
  {role:'tool-result',content:'print("hello world")',tokens:600},
  {role:'assistant',content:'Here\'s the contents of hello.py:\n\n```python\nprint("hello world")\n```\n\nIt\'s a simple script that prints "hello world".',tokens:720}
];
let playerPos=0,playing=false,playInterval;
function renderPlayerEntry(idx){
  if(idx>=sessionEntries.length)return;
  const e=sessionEntries[idx];
  const display=document.getElementById('playerDisplay');
  const div=document.createElement('div');div.className='player-entry';
  div.innerHTML=`<span class="player-role ${e.role}">[${e.role}]</span> ${e.content.replace(/\n/g,'<br>')}`;
  display.appendChild(div);display.scrollTop=display.scrollHeight;
  document.getElementById('playerTimeline').value=idx;
  document.getElementById('playerTokens').textContent=`Tokens: ${e.tokens.toLocaleString()} / 200k`;
}
function togglePlay(){
  playing=!playing;
  document.getElementById('playBtn').innerHTML=playing?'&#9646;&#9646; Pause':'&#9654; Play';
  if(playing){
    playInterval=setInterval(()=>{
      if(playerPos>=sessionEntries.length-1){togglePlay();return;}
      playerPos++;renderPlayerEntry(playerPos);
    },1200);
    addScore(2);
  }else{clearInterval(playInterval);}
}
function seekPlayer(v){
  playerPos=parseInt(v);
  document.getElementById('playerDisplay').innerHTML='';
  for(let i=0;i<=playerPos;i++)renderPlayerEntry(i);
}

// ========== SLIDE 10: CHAOS ==========
const chaosState=[false,false,false,false,false];
const chaosResponses=[
  ['[WARN] LLM request timeout after 30s','[INFO] Retry 1/3 with exponential backoff (2s)...','[WARN] Retry 1 failed — timeout','[INFO] Retry 2/3 with backoff (4s)...','[WARN] Retry 2 failed — timeout','[INFO] Falling back to secondary model: claude-sonnet-4-5','[OK] Fallback model responded in 1.2s','[INFO] Response delivered to user via fallback'],
  ['[ERR] Telegram webhook delivery failed: HTTP 502','[INFO] Retry 1/3 in 1s...','[ERR] Retry 1 failed: HTTP 502','[INFO] Retry 2/3 in 2s...','[OK] Retry 2 succeeded: HTTP 200','[INFO] Message delivered to Telegram'],
  ['[ERR] ENOSPC: no space left on device','[WARN] Cannot append to session transcript','[INFO] Buffering response in memory (max 50MB)','[WARN] Alerting operator: disk space critical','[INFO] Response delivered via channel (not persisted)','[WARN] Session state may be incomplete until disk space is freed'],
  ['[ERR] Auth token expired: oc_pat_... (expired 2h ago)','[INFO] Attempting token refresh via OAuth flow','[OK] New token acquired: oc_pat_fresh_...','[INFO] Replaying failed request with new token','[OK] Request succeeded with refreshed credentials'],
  ['[WARN] Context window 98% full (196k / 200k tokens)','[INFO] Triggering session compaction','[INFO] Summarizing oldest 50 messages → 1 summary block','[OK] Context reduced to 142k tokens (71% utilization)','[INFO] Compaction complete. Conversation continues normally.']
];
function toggleChaos(idx){
  chaosState[idx]=!chaosState[idx];
  document.getElementById('chaos'+idx).classList.toggle('on');
  const log=document.getElementById('chaosLog');
  if(chaosState[idx]){
    const responses=chaosResponses[idx];
    let delay=0;
    responses.forEach(r=>{
      delay+=400+Math.random()*300;
      setTimeout(()=>{
        const div=document.createElement('div');div.className='chaos-entry';
        const color=r.startsWith('[ERR]')?'var(--red)':r.startsWith('[WARN]')?'var(--ember)':r.startsWith('[OK]')?'var(--green)':'var(--dim)';
        div.innerHTML=`<span style="color:${color}">${r}</span>`;
        log.appendChild(div);log.scrollTop=log.scrollHeight;
      },delay);
    });
    addScore(2);
  }
}

// ========== SLIDE 11: SANDBOX ==========
const sandboxResponses=[
  {user:'What can you do?',gateway:'[route] default:session:main → Default Agent',agent:'[llm] Calling Claude Opus 4.6 (context: 1.2k tokens)\n[llm] Response: text (no tool calls)',response:'I can read and write files, execute shell commands, browse the web, search the internet, manage your calendar, and much more. What would you like help with?',fs:'session-main.jsonl +2 entries (user + assistant)'},
  {user:'List my files',gateway:'[route] default:session:main → Default Agent',agent:'[llm] Calling Claude Opus 4.6\n[llm] Response: tool_call → exec\n[tool] exec: ls -la /workspace\n[tool] exit_code: 0 (12ms)\n[llm] Second call with tool result\n[llm] Response: text',response:'Here are your files:\n- hello.py (127 bytes)\n- README.md (890 bytes)\n- src/ directory',fs:'session-main.jsonl +4 entries (user + tool_call + tool_result + assistant)'},
  {user:'Create a test file',gateway:'[route] default:session:main → Default Agent',agent:'[llm] Calling Claude Opus 4.6\n[llm] Response: tool_call → exec\n[tool] exec: echo "test" > test.txt\n[tool] exit_code: 0 (8ms)\n[llm] Second call\n[llm] Response: text',response:'Done! I\'ve created test.txt with the content "test".',fs:'session-main.jsonl +4 entries\nworkspace/test.txt CREATED'}
];
let sbIdx=0;
function sendSandbox(){
  const input=document.getElementById('sbInput');
  const msg=input.value.trim();if(!msg)return;input.value='';
  const r=sandboxResponses[sbIdx%sandboxResponses.length];sbIdx++;
  // Chat
  const chat=document.getElementById('sbChat');
  chat.innerHTML+=`<div style="color:#60a5fa;margin:4px 0"><strong>You:</strong> ${msg}</div>`;
  // Gateway
  setTimeout(()=>{document.getElementById('sbGateway').innerHTML+=`<div style="margin:4px 0;color:var(--cyan)">${r.gateway}</div>`;},200);
  // Agent
  const agentLines=r.agent.split('\n');
  let d=400;
  agentLines.forEach(l=>{d+=300;setTimeout(()=>{
    const color=l.includes('[tool]')?'var(--ember)':l.includes('[llm]')?'var(--purple)':'var(--dim)';
    document.getElementById('sbAgent').innerHTML+=`<div style="margin:2px 0;color:${color}">${l}</div>`;
    document.getElementById('sbAgent').scrollTop=999;
  },d);});
  // Response
  setTimeout(()=>{chat.innerHTML+=`<div style="color:var(--cyan);margin:4px 0"><strong>Agent:</strong> ${r.response}</div>`;chat.scrollTop=999;},d+400);
  // FS
  setTimeout(()=>{document.getElementById('sbFS').innerHTML+=`<div style="margin:4px 0;color:var(--gold)">${r.fs}</div>`;},d+200);
  addScore(3);
}

// ========== SLIDE 12: QUIZ ==========
const quizFB=[
  ['Right! WebSocket is the primary protocol, with JSON-RPC-like frames on port 18789.','Not quite. OpenClaw uses WebSocket as its primary real-time protocol.'],
  ['Correct! JSONL (JSON Lines) — append-only, one object per line. No database needed.','Not quite. OpenClaw uses JSONL files for session transcripts.'],
  ['Exactly. The tool executes, result feeds back to the LLM, and the loop continues until a text response.','Not quite. Tool results are automatically fed back to the LLM.'],
  ['Right! Connections from 127.0.0.1 (loopback) are auto-approved with no credentials needed.','Not quite. Loopback (127.0.0.1) connections bypass auth entirely.'],
  ['Correct! Workspace skills have the highest precedence and override all other levels.','Not quite. Workspace skills sit at the top of the precedence hierarchy.'],
  ['Right! Channel plugins receive raw webhooks and normalize them into a standard Message format.','Not quite. Channels normalize platform-specific webhooks into a standard format.'],
  ['Correct! The Gateway exposes 80+ methods across chat, session, agent, config, and more.','Not quite. The Gateway has 80+ methods.'],
  ['Right! Pi is the embedded agent runtime inside OpenClaw.','Not quite. Pi is OpenClaw\'s embedded agent runtime for LLM and tool execution.'],
  ['Correct! ~470,000 lines of TypeScript on Node.js 22+.','Not quite. OpenClaw is built in TypeScript.'],
  ['Right! Retry with exponential backoff, then fall back to a secondary model.','Not quite. OpenClaw retries with backoff and falls back to alternative models.']
];
let quizCorrect=0,quizAnswered=0;
function answer(qid,btn,ok){
  const quiz=document.getElementById(qid);
  quiz.querySelectorAll('.quiz-opt').forEach(b=>{b.disabled=true;});
  btn.classList.add(ok?'correct':'wrong');
  if(!ok)quiz.querySelectorAll('.quiz-opt').forEach(b=>{if(b.onclick.toString().includes('true'))b.classList.add('correct');});
  const idx=parseInt(qid.replace('q',''));
  const fb=document.getElementById(qid+'fb');
  fb.textContent=ok?quizFB[idx][0]:quizFB[idx][1];
  fb.className='quiz-fb show '+(ok?'ok':'no');
  quizAnswered++;if(ok){quizCorrect++;addScore(2);}
  document.getElementById('quizTotal').textContent=quizCorrect+'/10 correct';
  if(quizAnswered===10){
    const r=document.getElementById('quizResult');r.style.display='block';
    const pct=Math.round(quizCorrect/10*100);
    document.getElementById('quizResultText').textContent=quizCorrect+'/10 ('+pct+'%)';
    document.getElementById('quizResultMsg').textContent=quizCorrect>=8?'Outstanding. You understand the full architecture.':quizCorrect>=5?'Solid foundation. Review the sections you missed.':'Worth revisiting the earlier sections for deeper understanding.';
  }
}

// ========== SLIDE 4: API EXPLORER ==========
const apiMethods=[
  {cat:'chat',name:'chat.send',desc:'Send a message to an agent session',params:'sessionKey, message',ret:'messageId'},
  {cat:'chat',name:'chat.stream',desc:'Stream a response token by token',params:'sessionKey',ret:'AsyncIterable<delta>'},
  {cat:'chat',name:'chat.cancel',desc:'Cancel an in-progress generation',params:'sessionKey',ret:'ok'},
  {cat:'chat',name:'chat.history',desc:'Get message history for a session',params:'sessionKey, limit?, before?',ret:'messages[]'},
  {cat:'chat',name:'chat.regenerate',desc:'Regenerate the last assistant message',params:'sessionKey',ret:'messageId'},
  {cat:'session',name:'session.list',desc:'List all sessions for an agent',params:'agentId?',ret:'sessions[]'},
  {cat:'session',name:'session.create',desc:'Create a new session',params:'agentId, title?',ret:'sessionKey'},
  {cat:'session',name:'session.delete',desc:'Delete a session and its transcript',params:'sessionKey',ret:'ok'},
  {cat:'session',name:'session.rename',desc:'Rename a session',params:'sessionKey, title',ret:'ok'},
  {cat:'session',name:'session.compact',desc:'Trigger session compaction to reduce token usage',params:'sessionKey',ret:'tokensSaved'},
  {cat:'agent',name:'agent.list',desc:'List all configured agents',params:'—',ret:'agents[]'},
  {cat:'agent',name:'agent.get',desc:'Get agent configuration',params:'agentId',ret:'AgentConfig'},
  {cat:'agent',name:'agent.create',desc:'Create a new agent',params:'name, model, workspace?',ret:'agentId'},
  {cat:'agent',name:'agent.update',desc:'Update agent configuration',params:'agentId, changes',ret:'ok'},
  {cat:'agent',name:'agent.delete',desc:'Delete an agent',params:'agentId',ret:'ok'},
  {cat:'config',name:'config.get',desc:'Get full gateway configuration',params:'—',ret:'Config (JSON5)'},
  {cat:'config',name:'config.set',desc:'Update configuration values',params:'path, value',ret:'ok'},
  {cat:'config',name:'config.reload',desc:'Hot-reload configuration from disk',params:'—',ret:'ok'},
  {cat:'channel',name:'channel.list',desc:'List connected channels',params:'—',ret:'channels[]'},
  {cat:'channel',name:'channel.status',desc:'Get channel connection status',params:'channelId',ret:'status'},
  {cat:'channel',name:'channel.reconnect',desc:'Force reconnect a channel',params:'channelId',ret:'ok'},
  {cat:'channel',name:'channel.send',desc:'Send a message through a channel',params:'channelId, chatId, content',ret:'ok'},
  {cat:'skill',name:'skill.list',desc:'List all loaded skills with precedence',params:'agentId?',ret:'skills[]'},
  {cat:'skill',name:'skill.get',desc:'Get skill content (SKILL.md)',params:'skillName',ret:'content'},
  {cat:'skill',name:'skill.install',desc:'Install a skill from URL or path',params:'source',ret:'ok'},
  {cat:'skill',name:'skill.remove',desc:'Remove a managed skill',params:'skillName',ret:'ok'},
  {cat:'cron',name:'cron.list',desc:'List scheduled jobs',params:'—',ret:'jobs[]'},
  {cat:'cron',name:'cron.create',desc:'Create a scheduled job',params:'schedule, agent, message',ret:'jobId'},
  {cat:'cron',name:'cron.delete',desc:'Delete a scheduled job',params:'jobId',ret:'ok'},
  {cat:'cron',name:'cron.trigger',desc:'Manually trigger a cron job now',params:'jobId',ret:'ok'},
  {cat:'system',name:'system.status',desc:'Gateway health and uptime',params:'—',ret:'{uptime, connections, version}'},
  {cat:'system',name:'system.connections',desc:'List active WebSocket connections',params:'—',ret:'connections[]'},
  {cat:'system',name:'system.logs',desc:'Stream gateway logs',params:'level?, limit?',ret:'logs[]'},
  {cat:'system',name:'system.shutdown',desc:'Gracefully shutdown the gateway',params:'—',ret:'ok'},
];
let apiCatFilter='all';
function buildAPIList(){
  const list=document.getElementById('apiList');list.innerHTML='';
  const search=document.getElementById('apiSearch').value.toLowerCase();
  const filtered=apiMethods.filter(m=>{
    if(apiCatFilter!=='all'&&m.cat!==apiCatFilter)return false;
    if(search&&!m.name.toLowerCase().includes(search)&&!m.desc.toLowerCase().includes(search))return false;
    return true;
  });
  filtered.forEach(m=>{
    const catColors={chat:'var(--cyan)',session:'var(--purple)',agent:'var(--green)',config:'var(--gold)',channel:'var(--ember)',skill:'var(--cyan)',cron:'var(--dim)',system:'var(--red)'};
    const card=document.createElement('div');card.className='api-card';
    card.innerHTML=`<div class="api-card-head" onclick="this.parentElement.classList.toggle('open');addScore(1)"><span><span style="color:${catColors[m.cat]||'var(--dim)'}">${m.cat}.</span>${m.name.split('.')[1]}</span><span class="dim" style="font-size:11px">${m.desc}</span></div><div class="api-card-body"><div style="margin-bottom:6px"><strong>Params:</strong> <span class="mono">${m.params}</span></div><div><strong>Returns:</strong> <span class="mono" style="color:var(--green)">${m.ret}</span></div><div style="margin-top:8px;padding:8px;background:var(--bg);border-radius:4px;font-family:monospace;font-size:11px">{"type":"request","id":"req_001","method":"${m.name}","params":{...}}</div></div>`;
    list.appendChild(card);
  });
  document.getElementById('apiSearch').placeholder=`Search ${filtered.length} methods...`;
}
function filterAPI(){buildAPIList();}
function filterAPICat(cat,btn){
  apiCatFilter=cat;
  document.querySelectorAll('.api-cat').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  buildAPIList();
}

// ========== SLIDE 5: NORMALIZER ==========
const normPlatforms=[
  {name:'Telegram',raw:'{\n  "update_id": 123456,\n  "message": {\n    "message_id": 42,\n    "from": {\n      "id": 987654321,\n      "first_name": "Mike"\n    },\n    "chat": {"id": -100123456},\n    "date": 1707580800,\n    "text": "Hello from Telegram"\n  }\n}',fields:[
    {id:'nf0',text:'987654321',slot:'sender',label:'from.id'},
    {id:'nf1',text:'"telegram"',slot:'channel',label:'platform'},
    {id:'nf2',text:'"Hello from Telegram"',slot:'text',label:'message.text'},
    {id:'nf3',text:'-100123456',slot:'chatId',label:'chat.id'},
    {id:'nf4',text:'1707580800',slot:'timestamp',label:'message.date'}
  ]},
  {name:'WhatsApp',raw:'{\n  "entry": [{\n    "changes": [{\n      "value": {\n        "messages": [{\n          "from": "+14155551234",\n          "timestamp": "1707580800",\n          "type": "text",\n          "text": {"body": "Hello from WhatsApp"}\n        }],\n        "metadata": {"phone_number_id": "123"}\n      }\n    }]\n  }]\n}',fields:[
    {id:'nf0',text:'+14155551234',slot:'sender',label:'messages[0].from'},
    {id:'nf1',text:'"whatsapp"',slot:'channel',label:'platform'},
    {id:'nf2',text:'"Hello from WhatsApp"',slot:'text',label:'text.body'},
    {id:'nf3',text:'"123"',slot:'chatId',label:'phone_number_id'},
    {id:'nf4',text:'1707580800',slot:'timestamp',label:'timestamp'}
  ]},
  {name:'Discord',raw:'{\n  "t": "MESSAGE_CREATE",\n  "d": {\n    "id": "1234567890",\n    "channel_id": "999888777",\n    "author": {\n      "id": "111222333",\n      "username": "mike_dev"\n    },\n    "content": "Hello from Discord",\n    "timestamp": "2026-02-10T14:30:00Z"\n  }\n}',fields:[
    {id:'nf0',text:'111222333',slot:'sender',label:'author.id'},
    {id:'nf1',text:'"discord"',slot:'channel',label:'platform'},
    {id:'nf2',text:'"Hello from Discord"',slot:'text',label:'d.content'},
    {id:'nf3',text:'999888777',slot:'chatId',label:'channel_id'},
    {id:'nf4',text:'2026-02-10T14:30:00Z',slot:'timestamp',label:'d.timestamp'}
  ]}
];
let normTab=0,normCorrect=0;
function switchNormTab(idx,btn){
  normTab=idx;normCorrect=0;
  document.querySelectorAll('.norm-tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('normScore').textContent='0/5 mapped';
  renderNormTab();
}
function renderNormTab(){
  const p=normPlatforms[normTab];
  document.getElementById('normRaw').innerHTML='<pre style="margin:0;color:var(--text)">'+p.raw+'</pre>';
  const fields=document.getElementById('normFields');fields.innerHTML='';
  p.fields.forEach(f=>{
    const el=document.createElement('span');el.className='norm-field';el.draggable=true;el.id=f.id+'_'+normTab;
    el.dataset.slot=f.slot;el.dataset.label=f.label;
    el.textContent=f.label+': '+f.text;
    el.ondragstart=function(e){e.dataTransfer.setData('text/plain',this.id);};
    fields.appendChild(el);
  });
  document.querySelectorAll('.norm-slot').forEach(s=>{s.classList.remove('filled');s.innerHTML='<span class="norm-slot-label">'+s.dataset.slot+':</span>';});
}
function dropNorm(e){
  e.preventDefault();e.currentTarget.classList.remove('over');
  const id=e.dataTransfer.getData('text/plain');
  const field=document.getElementById(id);if(!field)return;
  const targetSlot=e.currentTarget.dataset.slot;
  const fieldSlot=field.dataset.slot;
  if(targetSlot===fieldSlot){
    e.currentTarget.classList.add('filled');
    e.currentTarget.innerHTML='<span class="norm-slot-label">'+targetSlot+':</span><span style="color:var(--green)">'+field.textContent+'</span>';
    field.classList.add('placed');field.draggable=false;
    normCorrect++;addScore(2);
    document.getElementById('normScore').textContent=normCorrect+'/5 mapped';
  }else{
    field.style.borderColor='var(--red)';setTimeout(()=>field.style.borderColor='',600);
  }
}

// ========== SLIDE 10: TOOL WORKBENCH ==========
let wbTools=0,wbTokens=0;
function switchWBTab(idx,btn){
  document.querySelectorAll('.wb-tab').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.wb-panel').forEach(p=>p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('wbp'+idx).classList.add('active');
}
const wbBashCmds={
  'ls':'-rw-r--r--  hello.py\n-rw-r--r--  README.md\ndrwxr-xr-x  src/',
  'pwd':'/workspace','date':'Tue Feb 11 07:30:00 PST 2026',
  'whoami':'openclaw','cat hello.py':'print("hello world")',
  'echo hello':'hello','uname -a':'Darwin openclaw 25.2.0 arm64',
  'node --version':'v22.12.0','npm --version':'10.9.2',
  'which openclaw':'/usr/local/bin/openclaw'
};
function runWBBash(){
  const input=document.getElementById('wbBashIn');
  const cmd=input.value.trim();if(!cmd)return;input.value='';
  const body=document.getElementById('wbBash');
  body.innerHTML+=`<div><span class="term-prompt">$ </span><span class="term-cmd">${cmd}</span></div>`;
  const out=wbBashCmds[cmd]||`bash: ${cmd.split(' ')[0]}: command not found`;
  body.innerHTML+=`<div class="term-out">${out}</div>`;
  body.scrollTop=body.scrollHeight;
  wbTools++;wbTokens+=Math.floor(50+Math.random()*100);updateWBCounter();addScore(1);
}
function runWBBrowse(){
  const input=document.getElementById('wbBrowseIn');
  const url=input.value.trim();if(!url)return;input.value='';
  const page=document.getElementById('wbPage');
  page.innerHTML=`<h3 style="margin:0 0 8px;color:#333">${url}</h3><p style="margin:0;color:#666">Page content extracted: 1,247 characters, 3 links, 2 images</p>`;
  wbTools++;wbTokens+=Math.floor(200+Math.random()*300);updateWBCounter();addScore(1);
}
function wbFileAction(type){
  const body=document.getElementById('wbFiles');
  if(type==='read')body.innerHTML+=`<div style="margin:4px 0;color:var(--green)">[read] hello.py → print("hello world")</div>`;
  if(type==='read2')body.innerHTML+=`<div style="margin:4px 0;color:var(--green)">[read] README.md → # OpenClaw Workspace...</div>`;
  if(type==='ls')body.innerHTML+=`<div style="margin:4px 0;color:var(--cyan)">[ls] 2 files, 1 directory</div>`;
  wbTools++;wbTokens+=Math.floor(30+Math.random()*50);updateWBCounter();addScore(1);
}
function runWBFile(){
  const input=document.getElementById('wbFileIn');
  const cmd=input.value.trim();if(!cmd)return;input.value='';
  const body=document.getElementById('wbFiles');
  if(cmd.startsWith('create ')){
    const fn=cmd.replace('create ','');
    body.innerHTML+=`<div class="ftree-item ftree-file" style="margin-left:16px;color:var(--green)">${fn} (created)</div>`;
  }else if(cmd.startsWith('delete ')){
    body.innerHTML+=`<div style="margin:4px 0;color:var(--red)">[deleted] ${cmd.replace('delete ','')}</div>`;
  }
  wbTools++;wbTokens+=Math.floor(20+Math.random()*30);updateWBCounter();addScore(1);
}
function runWBAgent(){
  const input=document.getElementById('wbAgentIn');
  const task=input.value.trim();if(!task)return;input.value='';
  const body=document.getElementById('wbAgent');
  body.innerHTML+=`<div style="color:var(--cyan);margin:4px 0">[spawn] Sub-agent created for: "${task}"</div>`;
  setTimeout(()=>body.innerHTML+=`<div style="color:var(--purple);margin:4px 0">[sub-agent] Using claude-sonnet-4-5 (cost-optimized)</div>`,400);
  setTimeout(()=>body.innerHTML+=`<div style="color:var(--green);margin:4px 0">[sub-agent] Task completed. Result merged into parent context.</div>`,1200);
  wbTools++;wbTokens+=Math.floor(500+Math.random()*1000);updateWBCounter();addScore(2);
}
function updateWBCounter(){
  document.getElementById('wbToolCount').textContent=wbTools;
  document.getElementById('wbTokenCount').textContent=wbTokens.toLocaleString();
  document.getElementById('wbCost').textContent='$'+(wbTokens*0.000015).toFixed(4);
}

// ========== SLIDE 11: MULTI-AGENT ==========
const maScenarios=[
  {name:'Simple Delegation',nodes:[
    {id:'ma0',label:'Gateway',x:10,y:40,color:'var(--cyan)'},
    {id:'ma1',label:'Default Agent\n(Opus 4.6)',x:45,y:40,color:'var(--purple)'},
    {id:'ma2',label:'Sub-Agent\n(Sonnet 4.5)',x:80,y:40,color:'var(--green)'}
  ],flow:[[0,1],[1,2],[2,1],[1,0]]},
  {name:'Parallel Fan-Out',nodes:[
    {id:'ma0',label:'Gateway',x:10,y:40,color:'var(--cyan)'},
    {id:'ma1',label:'Coordinator\n(Opus 4.6)',x:38,y:40,color:'var(--purple)'},
    {id:'ma2',label:'Research\n(Sonnet 4.5)',x:68,y:15,color:'var(--green)'},
    {id:'ma3',label:'Code\n(Sonnet 4.5)',x:68,y:40,color:'var(--ember)'},
    {id:'ma4',label:'Review\n(Haiku 4.5)',x:68,y:65,color:'var(--gold)'}
  ],flow:[[0,1],[1,2],[1,3],[1,4],[2,1],[3,1],[4,1],[1,0]]},
  {name:'Chain Pipeline',nodes:[
    {id:'ma0',label:'Gateway',x:5,y:40,color:'var(--cyan)'},
    {id:'ma1',label:'Intake\n(Haiku)',x:25,y:40,color:'var(--gold)'},
    {id:'ma2',label:'Research\n(Sonnet)',x:45,y:40,color:'var(--green)'},
    {id:'ma3',label:'Draft\n(Opus)',x:65,y:40,color:'var(--purple)'},
    {id:'ma4',label:'Review\n(Opus)',x:85,y:40,color:'var(--ember)'}
  ],flow:[[0,1],[1,2],[2,3],[3,4],[4,0]]}
];
let maCurrentScenario=0;
function loadMA(idx){
  maCurrentScenario=idx;
  const canvas=document.getElementById('maCanvas');
  const s=maScenarios[idx];
  canvas.innerHTML='';
  s.nodes.forEach(n=>{
    const div=document.createElement('div');div.className='ma-node';div.id=n.id;
    div.style.left=n.x+'%';div.style.top=n.y+'%';
    div.style.borderColor=n.color;
    div.innerHTML=n.label.replace('\n','<br><span class="ma-model" style="color:'+n.color+'">');
    if(n.label.includes('\n'))div.innerHTML+='</span>';
    canvas.appendChild(div);
  });
  addScore(1);
}
function _mkP(canvas,color){
  const p=document.createElement('div');
  p.dataset.particle='1';
  p.style.cssText='position:absolute;width:12px;height:12px;border-radius:50%;background:'+(color||'var(--gold)')+';box-shadow:0 0 14px '+(color||'var(--gold)')+';z-index:10;transition:all .4s ease;opacity:0;';
  canvas.appendChild(p);return p;
}
function _posP(p,el,canvas){
  const r=el.getBoundingClientRect(),cr=canvas.getBoundingClientRect();
  p.style.left=(r.left-cr.left+r.width/2-6)+'px';
  p.style.top=(r.top-cr.top+r.height/2-6)+'px';
}
function runMA(){
  const s=maScenarios[maCurrentScenario];
  const canvas=document.getElementById('maCanvas');
  canvas.querySelectorAll('[data-particle]').forEach(p=>p.remove());
  if(maCurrentScenario===1){runMAParallel(s,canvas);return;}
  // Sequential for scenarios 0 and 2
  const particle=_mkP(canvas);
  const startEl=document.getElementById(s.nodes[s.flow[0][0]].id);
  if(startEl){_posP(particle,startEl,canvas);particle.style.opacity='1';}
  let step=0;
  function animateStep(){
    if(step>=s.flow.length){setTimeout(()=>particle.remove(),300);addScore(2);return;}
    const[from,to]=s.flow[step];
    const fromEl=document.getElementById(s.nodes[from].id),toEl=document.getElementById(s.nodes[to].id);
    if(!fromEl||!toEl){step++;setTimeout(animateStep,100);return;}
    fromEl.classList.add('active');
    _posP(particle,toEl,canvas);
    setTimeout(()=>{fromEl.classList.remove('active');toEl.classList.add('active');setTimeout(()=>toEl.classList.remove('active'),300);},400);
    step++;setTimeout(animateStep,600);
  }
  setTimeout(animateStep,200);
}
function runMAParallel(s,canvas){
  const colors=['var(--green)','var(--ember)','var(--gold)'];
  const gw=document.getElementById('ma0'),coord=document.getElementById('ma1');
  // Phase 1: Gateway -> Coordinator
  const p0=_mkP(canvas,'var(--cyan)');_posP(p0,gw,canvas);p0.style.opacity='1';
  setTimeout(()=>{
    gw.classList.add('active');_posP(p0,coord,canvas);
    setTimeout(()=>{gw.classList.remove('active');coord.classList.add('active');},400);
  },200);
  // Phase 2: Fan-out — 3 particles leave coordinator simultaneously
  setTimeout(()=>{
    p0.style.opacity='0';
    const targets=['ma2','ma3','ma4'];
    const parts=targets.map((tid,i)=>{
      const p=_mkP(canvas,colors[i]);_posP(p,coord,canvas);p.style.opacity='1';
      setTimeout(()=>{_posP(p,document.getElementById(tid),canvas);setTimeout(()=>document.getElementById(tid).classList.add('active'),400);},50);
      return p;
    });
    coord.classList.remove('active');
    // Phase 3: All 3 return simultaneously
    setTimeout(()=>{
      targets.forEach(t=>document.getElementById(t).classList.remove('active'));
      parts.forEach(p=>_posP(p,coord,canvas));
      setTimeout(()=>{
        coord.classList.add('active');
        // Phase 4: Coordinator -> Gateway
        setTimeout(()=>{
          parts.forEach(p=>{p.style.opacity='0';setTimeout(()=>p.remove(),400);});
          coord.classList.remove('active');
          const pf=_mkP(canvas,'var(--cyan)');_posP(pf,coord,canvas);pf.style.opacity='1';
          setTimeout(()=>{
            _posP(pf,gw,canvas);
            setTimeout(()=>{gw.classList.add('active');setTimeout(()=>{gw.classList.remove('active');pf.remove();p0.remove();},500);},400);
          },200);
        },400);
      },400);
    },1200);
  },900);
  addScore(2);
}

// ========== SLIDE 14: NETWORK TOPOLOGY ==========
function traceTopo(){
  const nodes=['tp0','tp1','tp3','tp4','tp5','tp7','tp5','tp6','tp8','tp6','tp5','tp4','tp3','tp1','tp0'];
  const labels=['User sends message','Telegram receives','Webhook fires to OpenClaw','Gateway authenticates & routes','Pi agent receives','LLM call to Claude API','Response received','Tool execution needed','Bash command runs','Result captured','Tool result fed back to LLM','Final response routed','Webhook response sent','Platform delivers','User sees reply'];
  const latencies=['0ms','+50ms','+80ms','+2ms','+5ms','+800ms','+1200ms','+5ms','+12ms','+12ms','+600ms','+2ms','+10ms','+50ms','+100ms'];
  let i=0;
  const info=document.getElementById('topoInfo');info.style.display='block';
  function step(){
    if(i>=nodes.length){
      document.querySelectorAll('.topo-node').forEach(n=>n.classList.remove('lit'));
      info.innerHTML='<span class="accent">Trace complete!</span> Total round-trip: ~2.9s. The LLM API calls dominate at ~1.8s combined.';
      addScore(3);return;
    }
    document.querySelectorAll('.topo-node').forEach(n=>n.classList.remove('lit'));
    document.getElementById(nodes[i]).classList.add('lit');
    info.innerHTML=`<span class="accent">Step ${i+1}/${nodes.length}:</span> ${labels[i]} <span class="dim">(${latencies[i]})</span>`;
    i++;setTimeout(step,350);
  }
  step();
}

// ========== SLIDE 15: WATERFALL ==========
function toggleWFDetail(idx){
  const d=document.getElementById('wfd'+idx);
  d.classList.toggle('show');addScore(1);
}
function updateWF(val){
  const mult=val/100;
  document.getElementById('wfMultLabel').textContent=mult.toFixed(1)+'x';
  document.querySelectorAll('.wf-bar').forEach(bar=>{
    const baseW=parseFloat(bar.dataset.baseW);
    const baseL=parseFloat(bar.dataset.baseL);
    bar.style.width=(baseW*mult)+'%';
  });
}

// ========== SLIDE 16: PROVIDER COMPARE ==========
function runProvCompare(){
  const prompt=document.getElementById('provPrompt').value;
  // Claude response
  const claudeResp='Quantum entanglement is a phenomenon where two or more particles become correlated in such a way that measuring the quantum state of one instantly determines the state of the other, regardless of the distance separating them. This "spooky action at a distance," as Einstein called it, occurs because entangled particles share a single quantum state described by one wave function.';
  const gptResp='Quantum entanglement occurs when two particles become linked so that the quantum state of one instantly influences the other, no matter how far apart they are. When you measure one particle, you immediately know the state of its partner. This phenomenon, which Einstein called "spooky action at a distance," is now a cornerstone of quantum computing and quantum cryptography.';
  // Simulate typing
  const bodyA=document.getElementById('provA');bodyA.innerHTML='';
  const bodyB=document.getElementById('provB');bodyB.innerHTML='';
  let iA=0,iB=0;
  const intA=setInterval(()=>{if(iA>=claudeResp.length){clearInterval(intA);return;}bodyA.textContent+=claudeResp[iA++];},8);
  setTimeout(()=>{
    const intB=setInterval(()=>{if(iB>=gptResp.length){clearInterval(intB);return;}bodyB.textContent+=gptResp[iB++];},10);
  },200);
  // Stats
  setTimeout(()=>{
    document.getElementById('provATokens').textContent='342';document.getElementById('provALat').textContent='1.8s';document.getElementById('provACost').textContent='$0.02';
    document.getElementById('provBTokens').textContent='318';document.getElementById('provBLat').textContent='1.2s';document.getElementById('provBCost').textContent='$0.01';
  },500);
  addScore(2);
}
function hotSwapProv(){
  const bodyA=document.getElementById('provA');
  bodyA.innerHTML+='<div style="margin-top:8px;padding:6px;background:rgba(234,179,8,.08);border-radius:3px;font-size:11px;color:var(--gold)">[hot-swap] Switching from Opus 4.6 → Sonnet 4.5 for remaining turns. Context preserved, model changed.</div>';
  addScore(1);
}

// ========== SLIDE 17: DOCKER LAYERS ==========
let dockerCorrect=0;
const dockerErrors={
  '0':'ERROR: Base image must be first. Nothing to build on.',
  '1':'ERROR: WORKDIR requires a base image (FROM) first.',
  '2':'ERROR: COPY requires a working directory context.',
  '3':'ERROR: RUN npm ci — package.json not yet copied!',
  '4':'ERROR: COPY . . — dependencies not installed, node_modules missing.',
  '5':'ERROR: EXPOSE must come after the application is assembled.'
};
function dropDocker(e){
  e.preventDefault();e.currentTarget.classList.remove('over');
  const id=e.dataTransfer.getData('text/plain');
  const layer=document.getElementById(id);if(!layer)return;
  const expectedPos=parseInt(e.currentTarget.dataset.pos);
  const layerOrder=parseInt(layer.dataset.order);
  if(layerOrder===expectedPos){
    e.currentTarget.classList.add('filled');
    e.currentTarget.textContent=layer.textContent;
    e.currentTarget.style.color='var(--green)';e.currentTarget.style.borderColor='var(--green)';
    layer.classList.add('placed');layer.draggable=false;layer.classList.add('correct');
    dockerCorrect++;addScore(2);
    document.getElementById('dockerScore').textContent=dockerCorrect+'/6 correct';
    document.getElementById('dockerErr').style.display='none';
  }else{
    layer.classList.add('wrong');setTimeout(()=>layer.classList.remove('wrong'),500);
    const err=document.getElementById('dockerErr');
    err.style.display='block';
    err.textContent=dockerErrors[expectedPos]||'ERROR: Wrong layer order.';
  }
}

// ========== GRADUATION ==========
function showGrad(){
  document.getElementById('gradScore').textContent=score+' / '+maxScore+' points explored';
}

// ========== INIT ==========
buildNav();
goTo(0);
document.getElementById('fileTree').innerHTML=renderTree(fileTreeData);
updateSkillPreview();
renderPlayerEntry(0);
setTimeout(startFrames,2000);
buildAPIList();
renderNormTab();
loadMA(0);
</script>
</body>
</html>
